jQuery("html").addClass("js");jQuery(document).ready(function($){window.TvrSharedVars={};window.TvrSharedVars.totalSecs=parseInt($("#total-sec-count").text());window.TvrSharedVars.context="default";window.TvrSharedVars.curSelCSS="#no-element";window.TvrSharedVars.TvrSugCSS={};window.TvrSharedVars.intelli_css="#no-element";window.TvrSharedVars.highlightEnabled=true;window.TvrSharedVars.progCount=0;window.TvrSharedVars.intelli=false;$("#dissect-video, #pref-video").colorbox({iframe:true,innerWidth:980,innerHeight:550});var TvrCom={hasValue:function(data){if(data!=""&&data!="undefined"&&data!=undefined&&data!=null){return true}else{return false}},ucwords:function(str){return(str+"").replace(/^([a-z])|\s+([a-z])/g,function($1){return $1.toUpperCase()})}};var TvrUi={visAutoView:($("#auto-visual-pref").attr("rel")=="1")?true:false,visAutoSaveDefault:($("#toggle-auto-save").attr("rel")=="1")?true:false,transEditing:($("#trans-editing").attr("rel")=="1")?true:false,transWizard:($("#trans-wizard").attr("rel")=="1")?true:false,visAutoSave:false,visualStylesEnabled:true,visualStylesDisabledBySort:false,visAddSecEnabled:false,visAddSelEnabled:false,visSecSortable:false,visSelSortable:false,visRawCSS:false,visRevisions:false,speedUp:false,fixedMenu:true,placeholderFrame:true,dataLoading:false,intelliAfterLoad:false,frameHeight:0,frameWidth:0,bodyWidth:null,displayMenuEmpty:true,totalSels:parseInt($("#total-sel-count").text()),trial:($("#plugin-trial").attr("rel")=="1")?false:true,trialNotice:"Please validate your purchase to unlock the full program! \nWith the free trial, you are limited to editing or creating 3 Sections and 9 Selectors (3 per Section).",gFontTarget:Object(),secInFocus:"",prevSecInFocus:"",selInFocusID:"",prevSelInFocusID:"",curSelTrackerID:"",visualLastEditedSel:"",visualTriggerSel:"",selsToLoad:0,totalToLoad:0,lastPostedDataString:null,init:function(){if(TvrUi.trial){$("#tvr-ui").delegate("div.trial-disabled a.edit-styles, div.trial-disabled a.reveal-add-selector","click",function(){alert(TvrUi.trialNotice);return false})}$(window).keypress(function(event){if(!(event.which==115&&event.ctrlKey)&&!(event.which==19)){return true}event.preventDefault();return false});$(document).keydown(function(event){if(event.which==83&&event.ctrlKey==true){TvrUi.ajax_save_settings("save");event.preventDefault();return false}});var $uiCon=$("#tvr-ui");$uiCon.click(function(e){var $clicked=$(e.target);try{cClasses=$clicked.attr("class");if(!cClasses){var cClasses="tvr-undefined"}}catch(err){}if($clicked.attr("id")=="load-visual"||cClasses.indexOf("sub-options-heading")>=0){TvrUi.load_visual_view($clicked)}else{if(cClasses.indexOf("sections-sortable")>=0){e.preventDefault();TvrUi.sections_sortable($clicked)}else{if(cClasses.indexOf("selectors-sortable")>=0){e.preventDefault();TvrUi.selectors_sortable($clicked)}else{if(cClasses.indexOf("reveal-add-section")>=0){e.preventDefault();TvrUi.toggle_add_section($clicked)}else{if(cClasses.indexOf("new-section-add")>=0){TvrUi.new_section_add($clicked,e)}else{if(cClasses.indexOf("delete-section")>=0){TvrUi.delete_section($clicked,e)}else{if(cClasses.indexOf("rename-section")>=0){e.preventDefault();var cur=TvrUi.get_section_meta($clicked);if($("#view-state-"+cur.secName+"-this").val()==0){var $baseObject=cur.secObject.find("a.edit-selectors");var ajaxLoadMode=1;TvrUi.update_view_state_tracker($baseObject,"section",ajaxLoadMode,$clicked,"sec rename, load selectors discretely")}else{var $emptySels=$("li#strk-"+cur.secName+' input[value="0"]');TvrUi.selsToLoad=$emptySels.length;TvrUi.totalToLoad=TvrUi.selsToLoad;if(TvrUi.selsToLoad>0){$emptySels.each(function(){var metaArray=$(this).attr("id").split("-");TvrUi.ajax_load_ui_data("",metaArray[2],metaArray[3],$(this),"selector",3,$clicked,"sec rename, load styles discretely")})}else{TvrUi.reveal_rename_section($clicked)}}}else{if(cClasses.indexOf("rename-button")>=0){TvrUi.action_rename_section($clicked,e)}else{if(cClasses.indexOf("edit-selectors")>=0){e.preventDefault();var ajaxLoadMode=2;TvrUi.update_view_state_tracker($clicked,"section",ajaxLoadMode,"","edit section selectors, load selectors visibly")}else{if(cClasses.indexOf("reveal-add-selector")>=0){e.preventDefault();TvrUi.toggle_add_selector($clicked)}else{if(cClasses.indexOf("add-selector")>=0){TvrUi.add_selector($clicked,e)}else{if(cClasses.indexOf("delete-selector")>=0){TvrUi.delete_selector($clicked,e)}else{if(cClasses.indexOf("modify-selector")>=0){e.preventDefault();var cur=TvrUi.get_selector_meta($clicked);if($("#view-state-"+cur.secName+"-"+cur.selName).val()==0){var $baseObject=cur.selObject.find("a.edit-styles");var ajaxLoadMode=1;TvrUi.update_view_state_tracker($baseObject,"selector",ajaxLoadMode,$clicked,"modify selector, load styles discretely")}else{TvrUi.reveal_modify_selector($clicked,e)}}else{if(cClasses.indexOf("modify-button")>=0){TvrUi.action_modify_selector($clicked,e)}else{if(cClasses.indexOf("edit-styles")>=0){e.preventDefault();var ajaxLoadMode=2;TvrUi.update_view_state_tracker($clicked,"selector",ajaxLoadMode,"","edit selector styles, load styles visibly")}else{if(cClasses.indexOf("style-config")>=0){TvrUi.style_config($clicked,e)}else{if(cClasses.indexOf("mq-tab")>=0&&cClasses.indexOf("active")<0){TvrUi.mq_tab_pressed($clicked)}else{if(cClasses.indexOf("snippet")>=0){e.preventDefault();TvrUi.load_docs($clicked)}else{if(cClasses.indexOf("help-trigger")>=0){TvrUi.load_docs($clicked)}else{if(cClasses.indexOf("bg-image-option")>=0||cClasses.indexOf("bg-image-select")>=0){TvrUi.bg_image_option($clicked,e)}else{if(cClasses.indexOf("view-bg-images")>=0){TvrUi.view_bg_images($clicked,e)}else{if(cClasses.indexOf("hand-css-reveal")>=0){TvrUi.hand_css_reveal($clicked,e)}else{if(cClasses.indexOf("css-area-tab")>=0){TvrUi.update_hand_css_tab($clicked)}else{if(cClasses.indexOf("export-section")>=0){TvrUi.export_section_checkbox($clicked,e)}else{if(cClasses.indexOf("important-toggle")>=0){TvrUi.important_toggle($clicked,e)}else{if(cClasses.indexOf("reveal-revisions")>=0){e.preventDefault();TvrUi.ajax_load_revisions_table($clicked)}else{if(cClasses.indexOf("restore-link")>=0){TvrUi.restore_rev($clicked,e)}}}}}}}}}}}}}}}}}}}}}}}}}}}});$uiCon.dblclick(function(e){var $clicked=$(e.target);if($clicked.hasClass("autofillable")){var autoVal=$clicked.val();var autoRel=$clicked.attr("rel");if(autoVal!=""){$clicked.parent().parent().find('input[rel="'+autoRel+'"]').attr("value",autoVal)}}});$("#cboxTitle a.insert-bg").live("click",function(e){e.preventDefault();var imgValue=$(this).attr("href");var selectName=$(this).attr("rel");var secSel=selectName.replace("][styles][background][background_image]","").replace("tvr_mcth[","").split("][");var sectionName=secSel[0];var selectorName=secSel[1];var $bgCon=$("#group-"+sectionName+"-"+selectorName+"-background");$('select[name="'+selectName+'"]',$bgCon).val(imgValue);$.colorbox.close();var newAlt=$("a.view-bg-images",$bgCon).attr("rel");newAlt+=imgValue;$("a.view-bg-images",$bgCon).attr("alt",newAlt).attr("title",imgValue)});$("#hand-css-area").find("textarea").tabOverride();$("#tvr-ui").delegate("select.bg-position-select","change",function(){var $posSelect=$(this);var $cusPosFields=$posSelect.parent(".field-wrap").siblings(".bg-position-custom");if($posSelect.val()=="custom"){$cusPosFields.show("fast")}else{$cusPosFields.hide("fast")}});$("#tvr-ui").delegate("select.tvr-font-select","change",function(){var $fontSelect=$(this);var $cusFontField=$fontSelect.parent(".field-wrap").siblings(".tvr-font-custom");if($fontSelect.val()=="Google Font..."){$cusFontField.show("fast");TvrUi.gFontTarget=$(this).parent("div.field-wrap").next(".field-wrap").find(".property-input");$.colorbox({href:$("#fonts-api").attr("rel"),innerHeight:"80%",innerWidth:"95%",fixed:true,iframe:true,open:true})}else{$cusFontField.hide("fast")}});var $menCon=$("#fixed-menu");$menCon.click(function(e){var $clicked=$(e.target);try{cClasses=$clicked.attr("class");if(!cClasses){var cClasses="tvr-undefined"}}catch(err){}if(cClasses.indexOf("export-checkbox")>=0&&$clicked.is("input")){TvrUi.export_checkbox($clicked,$menCon,e)}else{if($clicked.attr("id")=="previewbutton"){TvrUi.previewbutton($clicked,$menCon,e)}else{if($clicked.attr("id")=="previewcss"){TvrUi.previewcss($clicked,$menCon,e)}else{if($clicked.attr("id")=="speed-up"){e.preventDefault();TvrUi.speed_up_ui($clicked,$menCon)}else{if($clicked.attr("id")=="close-all-ui"){e.preventDefault();TvrUi.close_all_ui_link($clicked,$menCon)}else{if($clicked.attr("id")=="ui-reset"){TvrUi.ui_reset($clicked,$menCon,e)}else{if($clicked.attr("id")=="clear-styles"){TvrUi.clear_styles($clicked,$menCon,e)}else{if($clicked.attr("id")=="ui-import"){TvrUi.ui_import($clicked,$menCon,e)}else{if($clicked.attr("id")=="email-error"){e.preventDefault();TvrUi.email_error_report($clicked,$menCon,e)}else{if($clicked.attr("id")=="toggle-fixed-menu"){TvrUi.toggle_fixed_menu()}}}}}}}}}}});$("select.export-select",$menCon).change(function(e){$(this).attr("title",$("select.export-select option:selected",$menCon).text());if($(this).val()=="new"){$("#export-new-name").show("fast")}else{$("#export-new-name").hide("fast")}});$("select.import-select",$menCon).change(function(e){if($(this).val()!=""){$("#overwrite-merge").show("fast")}else{$("#overwrite-merge").hide("fast")}});$("a#hide-notification").live("click",function(e){e.preventDefault();$("#ajax-message").hide("fast")});$("#tvr_microthemer_ui_save2").submit(function(e){e.preventDefault();TvrUi.ajax_save_settings("save")});$visCon=$("#visual-view");$visCon.click(function(e){var $clicked=$(e.target);try{cClasses=$clicked.attr("class");if(!cClasses){var cClasses="tvr-undefined"}}catch(err){}if($clicked.parent("div").attr("id")=="scroll-buttons"){TvrUi.tvr_iterate_selectors_v($clicked)}else{if($clicked.attr("id")=="vb-add-section"&&!$clicked.hasClass("disabled")){TvrUi.display_visual_add_sec_sel("Section")}else{if($clicked.attr("id")=="vb-add-selector"&&!$clicked.hasClass("disabled")){TvrUi.display_visual_add_sec_sel("Selector")}else{if($clicked.attr("id")=="toggle-editing"&&!$clicked.hasClass("disabled")){TvrUi.toggle_visual_style_options()}else{if($clicked.attr("id")=="toggle-highlighting"&&!$clicked.hasClass("disabled")){TvrUi.toggle_highlighting()}else{if($clicked.attr("id")=="toggle-auto-save"){TvrUi.toggle_auto_save()}else{if($clicked.attr("id")=="tvr-popup-menu"){TvrUi.hide_other_visual("",true)}else{if($clicked.attr("id")=="toggle-sortable-sections"){TvrUi.toggle_visual_sort("Section")}else{if($clicked.attr("id")=="toggle-sortable-selectors"){TvrUi.toggle_visual_sort("Selector")}else{if($clicked.attr("id")=="toggle-raw-css"){TvrUi.toggle_raw_css()}else{if($clicked.attr("id")=="toggle-revisions"){TvrUi.toggle_revisions()}else{if($clicked.attr("id")=="show-tutorials"||$clicked.attr("id")=="vis-help-video"){TvrUi.load_docs($clicked)}else{if($clicked.attr("id")=="close-visual"){TvrUi.close_visual_view()}}}}}}}}}}}}}});$("#vmenu-sections, #vmenu-selectors-display").change(function(e){var $clicked=$(this).find("option:selected");TvrUi.tvr_iterate_selectors_v($clicked)});if(TvrUi.visAutoView){TvrUi.load_visual_view($("#load-visual"))}},strk_mirror_order:function(ui,type){if(type=="section"){var $secObject=$(ui.item);var $prevSecObject=$secObject.prev();var secID=$secObject.attr("id").replace("section-","");if($prevSecObject.attr("id")==undefined){$("li#strk-"+secID).detach().prependTo("ul#view-states");$("#vmenu-"+secID).detach().prependTo($("#vmenu-sections").find("optgroup"));$("#vmenu-selectors").find('optgroup[rel="'+secID+'"]').detach().prependTo("#vmenu-selectors")}else{var prevSecID=$prevSecObject.attr("id").replace("section-","");$("li#strk-"+secID).detach().insertAfter("li#strk-"+prevSecID);$("#vmenu-"+secID).detach().insertAfter("#vmenu-"+prevSecID);$("#vmenu-selectors").find('optgroup[rel="'+secID+'"]').detach().insertAfter($("#vmenu-selectors").find('optgroup[rel="'+prevSecID+'"]'))}}else{if(type=="selector"){var $selObject=$(ui.item);var $prevSelObject=$selObject.prev();var cur=TvrUi.get_selector_meta($selObject,"this");var $curTracker=$("#view-state-"+cur.secName+"-"+cur.selName);var $curHidItem=$("#vmenu-"+cur.secName+"-"+cur.selName);var $selTracker=$("li#strk-"+cur.secName+" input:first");if($prevSelObject.attr("id")==undefined){$curTracker.detach().insertAfter($selTracker);$($curHidItem).detach().prependTo($("#vmenu-selectors").find('optgroup[rel="'+cur.secName+'"]'));if(cur.secName==TvrUi.secInFocus){var $curVisItem=$("#vmenu-display-"+cur.secName+"-"+cur.selName);$($curVisItem).detach().prependTo($("#vmenu-selectors-display").find("optgroup"))}}else{var prev=TvrUi.get_selector_meta($prevSelObject,"this");$curTracker.detach().insertAfter("#view-state-"+prev.secName+"-"+prev.selName);$($curHidItem).detach().insertAfter($("#vmenu-"+prev.secName+"-"+prev.selName));if(cur.secName==TvrUi.secInFocus){var $curVisItem=$("#vmenu-display-"+cur.secName+"-"+cur.selName);$($curVisItem).detach().insertAfter($("#vmenu-display-"+prev.secName+"-"+prev.selName))}}}}},sections_sortable:function($clicked){if($clicked.text()=="Enable Sortable Sections"){TvrUi.close_all_ui();$("#tvr-ui div.section-fields").addClass("sortable-sections").sortable({update:function(event,ui){TvrUi.strk_mirror_order(ui,"section")}});$clicked.text("Disable Sortable Sections");$("#tvr-ui a.edit-selectors").each(function(){$(this).fadeOut("slow",function(){$(this).after('<span class="disabled-message">Sections Are Sortable</span>')})})}else{if($clicked.text()=="Disable Sortable Sections"){$("#tvr-ui div.section-fields").removeClass("sortable-sections").sortable("destroy");$clicked.text("Enable Sortable Sections");$("#tvr-ui span.disabled-message").each(function(){$(this).fadeOut("slow",function(){$(this).remove();$("#tvr-ui a.edit-selectors").show()})})}}},selectors_sortable:function($clicked){var secName=$clicked.attr("rel");var $secCon=$("#"+secName+"-selectors");if($clicked.text()=="Enable Sortable Selectors"){$("div.hidden-options",$secCon).hide();$("#strk-"+secName+' input.selector-tracker[value="2"]').val(1);$("div.selector-fields",$secCon).addClass("sortable-selectors").sortable({update:function(event,ui){TvrUi.strk_mirror_order(ui,"selector")}});$clicked.text("Disable Sortable Selectors");$("a.edit-styles",$secCon).each(function(){$(this).fadeOut("slow",function(){$(this).after('<span class="disabled-message">Selectors Are Sortable</span>')})})}else{if($clicked.text()=="Disable Sortable Selectors"){$("div.selector-fields",$secCon).removeClass("sortable-selectors").sortable("destroy");$clicked.text("Enable Sortable Selectors");$("span.disabled-message",$secCon).each(function(){$(this).fadeOut("slow",function(){$(this).remove();$("a.edit-styles",$secCon).show()})})}}},toggle_add_section:function($clicked,e){if(!TvrUi.allowed_action($clicked,"Add Sec")){return false}$clicked.parent().siblings("div.new-section").slideToggle();if($clicked.text()=="Add New Section"){$clicked.text("Cancel")}else{if(window.TvrSharedVars.context=="visual"){TvrUi.hide_visual_add_sec_sel("Section",true)}$clicked.text("Add New Section")}},new_section_add:function($clicked,e){var sectionName=$clicked.siblings("input.new-section-input").val();if(sectionName==""){alert("Please enter a value for Section Name");return false}sectionName=TvrUi.sanitise_section(sectionName);var sectionID=sectionName.replace(/ /g,"_").toLowerCase();var newSection=$("div#section-template").clone().removeClass("template").removeClass("section-template").attr("id","section-"+sectionID);var H2html=newSection.find("h2").html().replace("<input",sectionName+"<input");newSection.find("h2").html(H2html);newSection.find("a.delete-section").attr("rel",sectionID);newSection.find(".rename-input").val(sectionName);newSection.find(".hidden-options, .add-selector, .rename-button").each(function(index){$(this).attr("id",$(this).attr("id").replace("selector_section",sectionID))});newSection.find("input").each(function(index){$(this).attr("name",$(this).attr("name").replace("[selector_section]","["+sectionID+"]"))});$("#section-fields").append(newSection);$("#section-"+sectionID).hide().fadeIn("fast",function(){$clicked.parent("div.new-section").slideUp();$clicked.siblings("input.new-section-input").val("");$("#tvr-ui .reveal-add-section").text("Add New Section");var $stateTracker=$("#section-count-state");TvrUi.update_count($stateTracker,"add",1,"section");$("#view-states").append('<li id="strk-'+sectionID+'" class="strk"><input type="hidden" id="view-state-'+sectionID+'-this" class="view-state-input section-tracker" name="tvr_mcth[non_section][view_state]['+sectionID+'][this]" title="" rel="" value="1" /></li>');$("#vmenu-sections").find("optgroup").append('<option id="vmenu-'+sectionID+'" class="vmenu-sec-option" selected="selected">'+sectionName+"</option>");var optGroup='<optgroup rel="'+sectionID+'" label="'+sectionName+'"><option id="vmenu-'+sectionID+'-this" class="vmenu-sel-option hidden" title=""></option></optgroup>';$("#vmenu-selectors").append(optGroup);if(window.TvrSharedVars.context=="visual"){TvrUi.tvr_iterate_selectors_v($("#vmenu-"+sectionID));TvrUi.hide_visual_add_sec_sel("Section",true)}})},delete_section:function($clicked,e){e.preventDefault();var sectionToGo=$clicked.attr("rel");var $secCon=$("#section-"+sectionToGo);var selectorCount=$("span.selector-count-state",$secCon).attr("rel");var linkObject=$("a.edit-selectors",$secCon);if(selectorCount>0){var w=confirm("This section contains CSS selectors. Are you sure you want to delete it?");if(w==true){TvrUi.delete_section_2($secCon,sectionToGo)}}else{TvrUi.delete_section_2($secCon,sectionToGo)}},delete_section_2:function($secCon,sectionToGo){$secCon.fadeOut("fast",function(){var numSels=$secCon.find("span.selector-count-state").attr("rel");$secCon.remove();var $countTracker=$("#section-count-state");TvrUi.update_count($countTracker,"subtract",1,"section",numSels);$vmenuItem=$("#vmenu-"+sectionToGo);var $nextMenuItem=$vmenuItem.next(".vmenu-sec-option");var $prevMenuItem=$vmenuItem.prev(".vmenu-sec-option");$vmenuItem.remove();$("#vmenu-selectors, #vmenu-selectors-display").find('optgroup[rel="'+sectionToGo+'"]').remove();$("li#strk-"+sectionToGo).remove();if(window.TvrSharedVars.context=="visual"){if(sectionToGo==TvrUi.secInFocus){if(TvrCom.hasValue($nextMenuItem.attr("id"))){var $clicked=$nextMenuItem}else{if(TvrCom.hasValue($prevMenuItem.attr("id"))){var $clicked=$prevMenuItem}else{var doNothing=true}}if(!doNothing){TvrUi.tvr_iterate_selectors_v($clicked)}}else{TvrUi.prevNext=TvrUi.update_visual_controls($("#"+TvrUi.selInFocusID.replace("selector","view-state")))}}TvrUi.clean_global_vars("del","Section",sectionToGo)})},clean_global_vars:function(con,type,oldVal,newVal){if(con=="del"){if(type=="Section"){if(oldVal==TvrUi.prevSecInFocus){TvrUi.prevSecInFocus=""}}var oldString="selector-"+oldVal;if(TvrUi.prevSelInFocusID.indexOf(oldString)>=0){TvrUi.prevSelInFocusID=""}if(TvrUi.visualLastEditedSel&&TvrUi.visualLastEditedSel.indexOf(oldString)>=0){TvrUi.visualLastEditedSel=""}if(TvrUi.visualTriggerSel.indexOf(oldString)>=0){TvrUi.visualTriggerSel=""}}else{if(con=="rename"){var oldString="selector-"+oldVal;var newString="selector-"+newVal;if(type=="Section"){if(oldVal==TvrUi.secInFocus){TvrUi.secInFocus=TvrUi.secInFocus.replace(oldVal,newVal)}if(oldVal==TvrUi.prevSecInFocus){TvrUi.prevSecInFocus=TvrUi.prevSecInFocus.replace(oldVal,newVal)}oldString+="-";newString+="-"}if((type=="Selector"&&oldString==TvrUi.selInFocusID)||type=="Section"){TvrUi.selInFocusID=TvrUi.selInFocusID.replace(oldString,newString)}if((type=="Selector"&&oldString==TvrUi.prevSelInFocusID)||type=="Section"){TvrUi.prevSelInFocusID=TvrUi.prevSelInFocusID.replace(oldString,newString)}if((type=="Selector"&&oldString==TvrUi.visualLastEditedSel)||type=="Section"){TvrUi.visualLastEditedSel=TvrUi.visualLastEditedSel.replace(oldString,newString)}if((type=="Selector"&&oldString==TvrUi.visualTriggerSel)||type=="Section"){TvrUi.visualTriggerSel=TvrUi.visualTriggerSel.replace(oldString,newString)}}}},reveal_rename_section:function($clicked){$clicked.siblings("div.rename").slideToggle();if($clicked.text()=="Rename Section"){$clicked.text("Cancel")}else{$clicked.text("Rename Section")}},action_rename_section:function($clicked,e){var newSection=$clicked.prev("input.rename-input").val();if(newSection==""){alert("Please enter a value for Section Name");return false}newSection=newSection.replace(/[^a-zA-Z0-9 ]+/g,"").replace("/ {2,}/"," ");var newSectionHuman=TvrCom.ucwords(newSection);newSection=newSection.replace(/ /g,"_").toLowerCase();var origSection=$clicked.attr("id").replace("-rename","");var origSectionHuman=origSection.replace(/\_/g," ");origSectionHuman=TvrCom.ucwords(origSectionHuman);var $secCon=$("#section-"+origSection);$("input, select",$secCon).each(function(index){$(this).attr("name",$(this).attr("name").replace("tvr_mcth["+origSection+"]","tvr_mcth["+newSection+"]").replace(/tvr_mcth\[non_section\]\[m_query\]\[([a-zA-Z0-9]+)\]\[([a-zA-Z0-9_]+)\]/,"tvr_mcth[non_section][m_query][$1]["+newSection+"]").replace("export_sections["+origSection+"]","export_sections["+newSection+"]").replace("rename_section["+origSection+"]","rename_section["+newSection+"]").replace("rename_button["+origSection+"]","rename_button["+newSection+"]").replace("tvr_mcth[non_section][important]["+origSection+"]","tvr_mcth[non_section][important]["+newSection+"]"))});var $secOption=$("#vmenu-"+origSection);var $oprgroups=$("#vmenu-selectors, #vmenu-selectors-display").find('optgroup[rel="'+origSection+'"]');var newSecOption=$secOption.text().replace(origSectionHuman,newSectionHuman);$secOption.text(newSecOption);$oprgroups.attr("label",newSectionHuman);$("input.rename-button, div.hidden-options, input.add-selector, input.modify-button, div.selector-wrap, div.tvr-ui-right",$secCon).add($secOption).add($oprgroups.find("option")).each(function(){try{$(this).attr("id",$(this).attr("id").replace(origSection,newSection))}catch(e){}});$("a.delete-selector, a.delete-section, a.selectors-sortable",$secCon).add($oprgroups).each(function(index){$(this).attr("rel",$(this).attr("rel").replace(origSection,newSection))});var $trkCon=$("li#strk-"+origSection);$("input.view-state-input",$trkCon).each(function(index){$(this).attr("id",$(this).attr("id").replace(origSection,newSection));$(this).attr("name",$(this).attr("name").replace("tvr_mcth[non_section][view_state]["+origSection+"]","tvr_mcth[non_section][view_state]["+newSection+"]"))});$trkCon.attr("id",$("li#strk-"+origSection).attr("id").replace(origSection,newSection));$secCon.attr("id","section-"+newSection);$secCon=$("#section-"+newSection);$clicked.parent(".rename").slideUp("fast",function(){$("a.rename-section",$secCon).text("Rename Section");var newH2html=$("h2.main-options-heading",$secCon).html().replace(origSectionHuman,newSectionHuman);$("h2.main-options-heading",$secCon).html(newH2html);TvrUi.clean_global_vars("rename","Section",origSection,newSection)})},edit_selectors:function($clicked){$clicked.parent().parent().siblings("div.hidden-options").toggle();if($clicked.text()=="Edit Selectors"){$clicked.text("Hide Selectors")}else{$clicked.text("Edit Selectors")}},allowed_action:function($clicked,con){if(!TvrUi.trial){return true}if(con=="Add Sec"){if(window.TvrSharedVars.totalSecs>2){var disallowed=true}}if(con=="Add Sel"){var cur=TvrUi.get_section_meta($clicked);var selsInSec=parseInt(cur.secObject.find("span.selector-count-state").attr("rel"));if(selsInSec>2){var disallowed=true}}if(disallowed){alert(TvrUi.trialNotice);return false}else{return true}},toggle_add_selector:function($clicked){if(!TvrUi.allowed_action($clicked,"Add Sel")){return false}$clicked.siblings("div.new-css-selectors").slideToggle();if($clicked.text()=="Add New Selector"){$clicked.text("Cancel")}else{if(window.TvrSharedVars.context=="visual"){TvrUi.hide_visual_add_sec_sel("Selector",true);if(window.parent.TvrSharedVars.intelli){$clicked.siblings("div.new-css-selectors").find("textarea.selector-css, input.selector-label").val("");TvrUi.toggle_enabled_buttons()}}$clicked.text("Add New Selector")}},add_selector:function($clicked,e){var selectorLabel=$clicked.siblings("input.selector-label").val();var selectorTitle=$clicked.parent().siblings(".new-css-selector-wrap").children("textarea.selector-css").val();if(selectorTitle.indexOf("{")>=0&&selectorLabel.indexOf("{}")<0){selectorLabel="{} "+selectorLabel}var selectorCSS=TvrUi.custom_escape_quotes(selectorTitle);if(selectorLabel==""||selectorCSS==""){alert("Please enter a value for CSS Selector and Label");return false}var selectorID=TvrUi.sanitise_selector_label(selectorLabel);var selectorSection=$clicked.attr("id").replace("-add","");var newSelector=$("div#selector-template").clone().removeClass("template").removeClass("selector-template").attr("id","selector-"+selectorSection+"-"+selectorID);newSelector.find("input.selector-label").attr("name","tvr_mcth["+selectorSection+"]["+selectorID+"][label]").attr("value",selectorLabel+"|"+selectorCSS);newSelector.find("input.radio").attr("name","tvr_mcth["+selectorSection+"]["+selectorID+"][pie]");newSelector.find("input.register-selector").attr("name","tvr_mcth["+selectorSection+"]["+selectorID+"]");newSelector.find("h3").text(selectorLabel).attr("title",selectorTitle);newSelector.find("textarea.modify-input-css").val(selectorTitle).attr("title",selectorTitle);newSelector.find("input.modify-input-label").val(selectorLabel);newSelector.find("a.delete-selector").attr("rel",selectorSection+"|"+selectorID);newSelector.find("div.tvr-ui-right, .modify-button").each(function(index){$(this).attr("id",$(this).attr("id").replace("selector_section",selectorSection).replace("selector_css",selectorID))});newSelector.find("input.style-config, input.register-group, input.device-focus").each(function(index){$(this).attr("name",$(this).attr("name").replace("selector_section",selectorSection).replace("selector_css",selectorID))});$("#"+selectorSection+"-selectors div.selector-fields").append(newSelector);$("#selector-"+selectorSection+"-"+selectorID).hide().fadeIn("fast",function(){$clicked.parents("div.new-css-selectors").slideUp();$clicked.siblings("input.selector-label").val("");$clicked.parent().siblings(".new-css-selector-wrap").children("textarea.selector-css").val("");$("#section-"+selectorSection+" a.reveal-add-selector").text("Add New Selector");var $stateTracker=$("#section-"+selectorSection).find(".selector-count-state");TvrUi.update_count($stateTracker,"add",1,"selector");$("#strk-"+selectorSection).append('<input type="hidden" id="view-state-'+selectorSection+"-"+selectorID+'" class="view-state-input selector-tracker" name="tvr_mcth[non_section][view_state]['+selectorSection+"]["+selectorID+']" title="'+selectorCSS+'" rel="'+selectorLabel+'" value="1" />');$("#vmenu-selectors").find('optgroup[rel="'+selectorSection+'"]').append('<option id="vmenu-'+selectorSection+"-"+selectorID+'" title="'+TvrUi.custom_to_regular_escape(selectorCSS)+'" class="vmenu-sel-option" selected="selected">'+selectorLabel+"</option>");$("#vmenu-selectors-display").find("optgroup").append('<option id="vmenu-display-'+selectorSection+"-"+selectorID+'" title="'+TvrUi.custom_to_regular_escape(selectorCSS)+'" class="vmenu-sel-option" selected="selected">'+selectorLabel+"</option>");if(window.TvrSharedVars.context=="visual"){TvrUi.tvr_iterate_selectors_v($("#vmenu-display-"+selectorSection+"-"+selectorID));TvrUi.hide_visual_add_sec_sel("Selector",true);if(!TvrUi.visualStylesEnabled){TvrUi.enable_visual_style_options()}}})},delete_selector:function($clicked,e){e.preventDefault();var secSel=$clicked.attr("rel").split("|");var sectionName=secSel[0];var selectorToGo=secSel[1];var $countTracker=$("#section-"+sectionName).find(".selector-count-state");var $selCon=$("#selector-"+sectionName+"-"+selectorToGo);var styleCount=parseInt($("span.style-count-state",$selCon).attr("rel"));var linkObject=$("a.edit-styles",$selCon);if(styleCount>0){var w=confirm("This CSS selector contains active styles. Are you sure you want to delete it?");if(w==true){TvrUi.delete_selector_2($selCon,sectionName,selectorToGo,$countTracker)}}else{TvrUi.delete_selector_2($selCon,sectionName,selectorToGo,$countTracker)}},delete_selector_2:function($selCon,sectionName,selectorToGo,$countTracker){$selCon.fadeOut("fast",function(){$selCon.remove();TvrUi.update_count($countTracker,"subtract",1,"selector");$("#view-state-"+sectionName+"-"+selectorToGo).remove();$("#vmenu-display-"+sectionName+"-"+selectorToGo+", #vmenu-"+sectionName+"-"+selectorToGo).remove();if(window.TvrSharedVars.context=="visual"){if("selector-"+sectionName+"-"+selectorToGo==TvrUi.selInFocusID){if(TvrUi.totalSels==0){return false}if(!$("#vb-focus-next").hasClass("disabled")){if(!TvrUi.prevNext["next-section"]){var $clicked=$("#vb-focus-next")}else{if(!TvrUi.prevNext["prev-section"]){var $clicked=$("#vb-focus-prev")}else{var $clicked=$("#vb-focus-next")}}}else{if(!$("#vb-focus-prev").hasClass("disabled")){var $clicked=$("#vb-focus-prev")}else{}}TvrUi.tvr_iterate_selectors_v($clicked)}else{TvrUi.prevNext=TvrUi.update_visual_controls($("#"+TvrUi.selInFocusID.replace("selector","view-state")))}}});TvrUi.clean_global_vars("del","Selector",sectionName+"-"+selectorToGo)},reveal_modify_selector:function($clicked,e){$clicked.parent().siblings("div.modify").slideToggle();if($clicked.text()=="Modify Selector"){$clicked.text("Cancel")}else{$clicked.text("Modify Selector")}},action_modify_selector:function($clicked,e){var selectorLabel=$clicked.siblings("input.modify-input-label").val();var selectorTitle=$clicked.parent().siblings(".css-selector-wrap").children("textarea.modify-input-css").val();if(selectorTitle.indexOf("{")>=0&&selectorLabel.indexOf("{}")<0){selectorLabel="{} "+selectorLabel}else{if(selectorTitle.indexOf("{")<0){selectorLabel=selectorLabel.replace("{} ","");$clicked.siblings("input.modify-input-label").val(selectorLabel)}}var selectorCSS=TvrUi.custom_escape_quotes(selectorTitle);if(selectorLabel==""||selectorCSS==""){alert("Please enter a value for CSS Selector and Label");return false}var newSelectorID=TvrUi.sanitise_selector_label(selectorLabel);var secSel=$clicked.attr("id").split("-modify-");var sectionName=secSel[0];var prevSelectorID=secSel[1];var $selCon=$("#selector-"+sectionName+"-"+prevSelectorID);$("input.selector-label",$selCon).attr("value",selectorLabel+"|"+selectorCSS);$("input, select",$selCon).each(function(index){$(this).attr("name",$(this).attr("name").replace(/tvr_mcth\[non_section\]\[m_query\]\[([a-zA-Z0-9]+)\]\[([a-zA-Z0-9_]+)\]\[([a-zA-Z0-9_]+)\]/,"tvr_mcth[non_section][m_query][$1][$2]["+newSelectorID+"]").replace("tvr_mcth["+sectionName+"]["+prevSelectorID+"]","tvr_mcth["+sectionName+"]["+newSelectorID+"]").replace("tvr_mcth[non_section][important]["+sectionName+"]["+prevSelectorID+"]","tvr_mcth[non_section][important]["+sectionName+"]["+newSelectorID+"]"))});$("input.modify-button, div.tvr-ui-right",$selCon).each(function(index){$(this).attr("id",$(this).attr("id").replace(sectionName+"-modify-"+prevSelectorID,sectionName+"-modify-"+newSelectorID).replace("group-"+sectionName+"-"+prevSelectorID,"group-"+sectionName+"-"+newSelectorID))});$("a.delete-selector",$selCon).each(function(index){$(this).attr("rel",$(this).attr("rel").replace(sectionName+"|"+prevSelectorID,sectionName+"|"+newSelectorID))});var $selTracker=$("#view-state-"+sectionName+"-"+prevSelectorID);$selTracker.attr("name",$selTracker.attr("name").replace("["+sectionName+"]["+prevSelectorID+"]","["+sectionName+"]["+newSelectorID+"]")).attr("id",$selTracker.attr("id").replace("view-state-"+sectionName+"-"+prevSelectorID,"view-state-"+sectionName+"-"+newSelectorID)).attr("rel",selectorLabel).attr("title",selectorCSS);var $vmenuItems=$("#vmenu-"+sectionName+"-"+prevSelectorID+", #vmenu-display-"+sectionName+"-"+prevSelectorID);$vmenuItems.each(function(){$(this).attr("id",$(this).attr("id").replace("-"+sectionName+"-"+prevSelectorID,"-"+sectionName+"-"+newSelectorID)).text(selectorLabel).attr("title",selectorTitle)});$selCon.attr("id","selector-"+sectionName+"-"+newSelectorID);$selCon=$("#selector-"+sectionName+"-"+newSelectorID);$("div.modify",$selCon).slideUp("fast",function(){$("a.modify-selector",$selCon).text("Modify Selector");$("h3.sub-options-heading",$selCon).text(selectorLabel).attr("title",selectorTitle);$("textarea.modify-input-css",$selCon).attr("title",selectorTitle);TvrUi.clean_global_vars("rename","Selector",sectionName+"-"+prevSelectorID,sectionName+"-"+newSelectorID)})},edit_styles:function($clicked){if(window.TvrSharedVars.context=="visual"){$clicked.parent().parent().siblings("div.hidden-options").slideToggle("fast")}else{$clicked.parent().parent().siblings("div.hidden-options").toggle()}if($clicked.text()=="Edit Styles"){$clicked.text("Hide Styles")}else{$clicked.text("Edit Styles")}},update_hand_css_tab:function($clicked){$("#css-tab-areas").find("span").removeClass("active");$clicked.addClass("active");$("#hand-css-area").find("textarea.show").removeClass("show");$("#"+$clicked.attr("rel")).addClass("show")},mq_tab_pressed:function($clicked){var $con=$clicked.parents(".tvr-ui-right");var tabKey=$clicked.attr("rel");TvrUi.update_mq_tab(tabKey,$con)},update_mq_tab:function(tabKey,$con){var $tabs=$con.find("div.query-tabs");$tabs.find("span.mq-tab").removeClass("active").end().find("span.tab-mq-"+tabKey).addClass("active").end().find("input.device-focus").val(tabKey);$con.find("div.property-fields.show").removeClass("show").end().find("div.property-mq-"+tabKey).addClass("show")},style_config:function($clicked,e){$area=$clicked.parents("div.row");if($clicked.hasClass("mq-toggle")){var con="mq";var metaArray=$clicked.attr("rel").split("|");var key=metaArray[0];var device=metaArray[1];var extraClass="-mq-"+key}else{var con="reg";var key="all-devices";var device="";var extraClass="-mq-all-devices";if($clicked.hasClass("all-toggle")){con="all"}}if(con=="reg"){$mainCheckbox=$clicked}else{var $mainCheckbox=$area.find("input.main-checkbox")}var numChecked=$area.find('span.property-group-state[rel="on"]').length;var propertyGroup=$clicked.val();var cur=TvrUi.get_selector_meta($clicked);var selectorSection=cur.secName;var selectorID=cur.selName;var $selObject=cur.selObject;var $stateTracker=$selObject.find("span.style-count-state");var $propCon=$("#group-"+selectorSection+"-"+selectorID+"-"+propertyGroup);if($clicked.next("span.property-group-state").attr("rel")=="off"){if(numChecked==0){$propCon.addClass("show")}var newPropGroup=$("#property-template-"+propertyGroup).clone().removeClass("template").removeClass("property-template-"+propertyGroup).addClass("property"+extraClass+" show").removeAttr("id");newPropGroup.find("input.property-input, select.property-input").each(function(index){$(this).attr("name",$(this).attr("name").replace("selector_section",selectorSection).replace("selector_css",selectorID))});newPropGroup.find("div.tvr-mq-right").each(function(index){$(this).attr("id",$(this).attr("id").replace("selector_section",selectorSection).replace("selector_css",selectorID))});if(con=="mq"){newPropGroup.find("input.property-input, select.property-input").each(function(index){$(this).attr("name",$(this).attr("name").replace("tvr_mcth","tvr_mcth[non_section][m_query]["+key+"]"))}).end().find("span.important-toggle").each(function(){$(this).removeClass("imp-reg").addClass("imp-mq")})}$propCon.find("div.property-fields").removeClass("show");$propCon.find("span.mq-tab").removeClass("active");$propCon.find("span.tab"+extraClass).addClass("show active");$propCon.append(newPropGroup).show().find("input.device-focus").val(key);TvrUi.jscolor_bind(selectorSection,selectorID,propertyGroup,"single-group");$clicked.next("span.property-group-state").attr("rel","on");if(propertyGroup=="CSS3"){$mainCheckbox.siblings("div.pie-switch").show()}if(numChecked==0){$mainCheckbox.prop("checked",true).next("span.property-group-state").attr("rel","on");TvrUi.update_count($stateTracker,"add",1,"style")}if(con=="reg"){$area.find("input.all-toggle").prop("checked",true).next("span.property-group-state").attr("rel","on")}}else{if($clicked.next("span.property-group-state").attr("rel")=="on"){if(con=="reg"){$target=$propCon.find("div.property-fields")}else{$target=$propCon.find("div.property"+extraClass)}$target.fadeOut("fast",function(){$target.remove()});var wasActive=false;if($propCon.find("span.tab"+extraClass).hasClass("active")){wasActive=true}$propCon.find("span.tab"+extraClass).removeClass("show active");$clicked.next("span.property-group-state").attr("rel","off");if(propertyGroup=="CSS3"){$mainCheckbox.siblings("div.pie-switch").hide()}if(numChecked==2||con=="reg"){$mainCheckbox.prop("checked",false).next("span.property-group-state").attr("rel","off");TvrUi.update_count($stateTracker,"subtract",1,"style");$propCon.find("span.mq-tab").removeClass("show active");$area.find("input.style-config").prop("checked",false);$area.find("span.property-group-state").attr("rel","off");$propCon.removeClass("show")}if(numChecked>2&&wasActive){$propCon.find("span.mq-tab.show:eq(0)").addClass("active").end().find("div.property-fields:eq(0)").addClass("show");$propCon.find("input.device-focus").val($propCon.find("span.mq-tab.active").attr("rel"))}}}},load_docs:function($clicked){if($clicked.hasClass("snippet")){var url=$clicked.attr("href")}else{if($clicked.hasClass("help-trigger")){var url=$("#show-tutorials").attr("rel")}}if($clicked.hasClass("g-font")){TvrUi.gFontTarget=$clicked.parents(".field-wrap").find(".property-input")}$.colorbox({href:url,innerHeight:"80%",innerWidth:"95%",fixed:true,iframe:true,open:true})},bg_image_option:function($clicked,e){if($clicked.hasClass("bg-image-option")){var $curImgObject=$clicked.parent().parent().siblings().children("a.view-bg-images");var $menu=$clicked.parent().parent()}else{var $curImgObject=$clicked.siblings().children("a.view-bg-images");var $menu=$clicked}$menu.change(function(e){var newImg=$clicked.val();var curImg=$curImgObject.attr("title");if(newImg!=curImg){if(newImg==""){$curImgObject.attr("alt",$("#first-bg-url").text()).attr("title","")}else{var newAlt=$curImgObject.attr("rel");newAlt=newAlt+=newImg;$curImgObject.attr("alt",newAlt).attr("title",newImg)}}})},view_bg_images:function($clicked,e){e.preventDefault();$("#bg-image-links a[rel='bg-image-ui']").colorbox({title:false,innerWidth:"60%",innerHeight:"70%",onComplete:function(){var $cbox=$("#cboxLoadedContent");$cbox.addClass("bg-img-squares");var curImg=$cbox.find("img").attr("src");var imgValue=curImg.replace(microUrl,"");$("#cboxTitle").html('<a class="insert-bg" href="'+imgValue+'"  rel="'+selectName+'" title="Click to Select">Select</a> | '+imgValue+"")}});var bg_url=$clicked.attr("alt");var microUrl=$clicked.attr("rel");var selectName=$clicked.parent().siblings("select").attr("name");$('#bg-image-links a[href="'+bg_url+'"]').colorbox({open:true,rel:"bg-image-ui",returnFocus:false,title:false,innerWidth:500,onComplete:function(){var $cbox=$("#cboxLoadedContent");$cbox.addClass("bg-img-squares");var curImg=$cbox.find("img").attr("src");var imgValue=curImg.replace(microUrl,"");$("#cboxTitle").html('<a class="insert-bg" href="'+imgValue+'"  rel="'+selectName+'" title="Click to Select">Select</a> | '+imgValue+"")}})},hand_css_reveal:function($clicked,e){e.preventDefault();$("#hand-css-area").toggle();if($clicked.text()=="Edit Hand-Coded CSS"){$clicked.text("Cancel")}else{$clicked.text("Edit Hand-Coded CSS")}},export_section_checkbox:function($clicked,e){if($clicked.attr("rel")=="off"){$clicked.attr("rel","on");var $menuCheckbox=$("#only-export-selected");if($menuCheckbox.attr("disabled")){$menuCheckbox.removeAttr("disabled").attr("checked","checked")}}else{if($clicked.attr("rel")=="on"){$clicked.attr("rel","off");var oneOrMore=false;$(".export-section:checked").each(function(){oneOrMore=true;return false});if(!oneOrMore){$("#only-export-selected").removeAttr("checked").attr("disabled","disabled")}}}},important_toggle:function($clicked,e){if($clicked.attr("rel")=="off"){var inputNameAtt=$clicked.next().attr("name");if(!$clicked.hasClass("imp-mq")){var importantNameAtt=inputNameAtt.replace("tvr_mcth","tvr_mcth[non_section][important]").replace("[styles]","")}else{var importantNameAtt=inputNameAtt.replace("[non_section]","[non_section][important]").replace("[styles]","")}var importantTracker='<input class="important-tracker" type="hidden" name="'+importantNameAtt+'" value="1" />';$clicked.attr("rel","on").addClass("tvr-toggle-on").before(importantTracker)}else{if($clicked.attr("rel")=="on"){$clicked.attr("rel","off").removeClass("tvr-toggle-on").prev(".important-tracker").remove()}}},get_section_meta:function($secChildObject,context){if(context=="this"){var $secObject=$secChildObject}else{var $secObject=$secChildObject.parents("div.section-wrap")}var cur=new Array();cur.secName=$secObject.attr("id").replace("section-","");cur.secObject=$secObject;return cur},get_selector_meta:function($selChildObject,context){if(context=="this"){var $selObject=$selChildObject}else{var $selObject=$selChildObject.parents("div.selector-wrap")}var curSelId=$selObject.attr("id");var curSecSel=curSelId.split("-");var cur=new Array();cur.secName=curSecSel[1];cur.selName=curSecSel[2];cur.selObject=$selObject;return cur},custom_escape_quotes:function(rawValue){var sanitisedValue=rawValue.replace(/"/g,"cus-quot;").replace(/'/g,"cus-#039;");return sanitisedValue},custom_to_regular_escape:function(rawValue){var sanitisedValue=rawValue.replace(/cus-/g,"&");return sanitisedValue},custom_to_non_escaped:function(rawValue){var sanitisedValue=rawValue.replace(/cus-quot;/g,'"').replace(/cus-#039;/g,"'");return sanitisedValue},close_all_ui:function(){$("#tvr-ui div.hidden-options").hide();$("#tvr-ui a.edit-selectors").text("Edit Selectors");$("#tvr-ui a.edit-styles").text("Edit Styles");$('#view-states input[value="2"]').val(1)},sanitise_section:function(rawSection){sanitisedSection=rawSection.replace(/[^a-zA-Z0-9 ]+/g,"").replace("/ {2,}/"," ").toLowerCase();sanitisedSection=TvrCom.ucwords(sanitisedSection);return sanitisedSection},sanitise_selector_label:function(rawLabel){sanitisedLabel=rawLabel.replace(/[^a-zA-Z0-9 ]+/g,"").replace("/ {2,}/"," ").replace(/ /g,"_");sanitisedLabel=sanitisedLabel.toLowerCase();return sanitisedLabel},jscolor_bind:function(selectorSection,selectorID,propertyGroup,inputScope,$clicked){var matchClass=new RegExp("(^|\\s)("+mcthmr_jscolor.bindClass+")\\s*(\\{[^}]*\\})?","i");if(inputScope=="single"){var e=$clicked}else{if(inputScope=="single-group"){var e=$("#group-"+selectorSection+"-"+selectorID+"-"+propertyGroup+" input.color")}else{if(inputScope=="all-groups"){var e=$("#selector-"+selectorSection+"-"+selectorID+" input.color")}else{if(inputScope=="all-selectors"){var e=$("#section-"+selectorSection+" input.color")}}}}for(var i=0;i<e.length;i+=1){var m;if((!e[i].color||e[i].color=="ffffff")&&e[i].className&&(m=e[i].className.match(matchClass))){var prop={};if(m[3]){try{eval("prop="+m[3])}catch(eInvalidProp){}}e[i].color=new mcthmr_jscolor.color(e[i],prop)}}},update_count:function($stateTracker,action,num,context,numSels){var $uiCon=$("#tvr-ui");var curValue=parseInt($stateTracker.attr("rel"));if(action=="add"){var newValue=curValue+num}else{if(action=="subtract"){var newValue=curValue-num}}if(curValue==0){$stateTracker.prev("a").after(' <span class="count-wrap">(<span class="state-count"></span>)</span>');var addBrackets=true}if(newValue==0){$stateTracker.prev("span").remove();var removeBrackets=true}$stateTracker.attr("rel",newValue);$stateTracker.prev("span").children("span").text(newValue);if(context=="section"){if(curValue==2&&newValue==1){var $sortButton=$("a#sections-sortable-button");$sortButton.fadeOut("fast",function(){$sortButton.remove()})}if(curValue==1&&newValue==2){$("span.section-count-state",$uiCon).after('<a href="#" id="sections-sortable-button" class="sections-sortable prominent-action">Enable Sortable Sections</a>');$("a#sections-sortable-button").hide().fadeIn("fast")}var $secCount=$("#total-sec-count");if(newValue>curValue){window.TvrSharedVars.totalSecs=(parseInt($secCount.text())+num);$secCount.text(window.TvrSharedVars.totalSecs)}else{window.TvrSharedVars.totalSecs=(parseInt($secCount.text())-num);$secCount.text(window.TvrSharedVars.totalSecs);TvrUi.totalSels=TvrUi.totalSels-numSels;$("#total-sel-count").text(TvrUi.totalSels)}}else{if(context=="selector"){var cur=TvrUi.get_section_meta($stateTracker);var sectionName=cur.secName;var $secMenuitem=$("#vmenu-"+sectionName);if(addBrackets){var str=$secMenuitem.text();$secMenuitem.text(str+" ("+newValue+")")}else{if(removeBrackets){var str=$secMenuitem.text().replace(/(.+) \(\d+\)$/,"$1");$secMenuitem.text(str)}else{var str=$secMenuitem.text().replace(/(.+) \(\d+\)$/,"$1 ("+newValue+")");$secMenuitem.text(str)}}if(curValue==2&&newValue==1){var $sortButton=$("#"+sectionName+"-selectors a.selectors-sortable",$uiCon);$sortButton.fadeOut("slow",function(){$sortButton.remove()})}if(curValue==1&&newValue==2){$("#"+sectionName+"-selectors div.selector-fields").after('<a href="#" rel="'+sectionName+'" class="selectors-sortable prominent-action">Enable Sortable Selectors</a>');$("#"+sectionName+"-selectors a.selectors-sortable").hide().fadeIn("slow")}var $selCount=$("#total-sel-count");if(newValue>curValue){TvrUi.totalSels=(parseInt($selCount.text())+num);$selCount.text(TvrUi.totalSels)}else{TvrUi.totalSels=(parseInt($selCount.text())-num);$selCount.text(TvrUi.totalSels)}}else{if(context=="style"){var cur=TvrUi.get_selector_meta($stateTracker);$("#vmenu-display-"+cur.secName+"-"+cur.selName+", #vmenu-"+cur.secName+"-"+cur.selName).each(function(){if(addBrackets){var str=$(this).text();$(this).text(str+" ("+newValue+")")}else{if(removeBrackets){var str=$(this).text().replace(/(.+) \(\d+\)$/,"$1");$(this).text(str)}else{var str=$(this).text().replace(/(.+) \(\d+\)$/,"$1 ("+newValue+")");$(this).text(str)}}})}}}if(window.TvrSharedVars.context=="visual"){TvrUi.toggle_enabled_buttons()}},update_view_state_tracker:function($clicked,type,ajaxLoadMode,$renameModify,context){if(type=="section"){var section=$clicked.parent().parent().parent().attr("id").replace("section-","");var $sectionTracker=$("#view-state-"+section+"-this");var trackerVal=$sectionTracker.val();if($sectionTracker.val()==0){TvrUi.ajax_load_ui_data($clicked,section,"",$sectionTracker,type,ajaxLoadMode,$renameModify,context)}else{if(trackerVal==1){$sectionTracker.val(2);TvrUi.edit_selectors($clicked);if(window.TvrSharedVars.context=="visual"&&TvrUi.visualStylesEnabled){TvrUi.enable_visual_style_options_2()}}else{if(trackerVal==2){$sectionTracker.val(1);TvrUi.edit_selectors($clicked)}}}}if(type=="selector"){var bothArry=$clicked.parent().parent().parent().attr("id").replace("selector-","").split("-");var section=bothArry[0];var selector=bothArry[1];var $selectorTracker=$("#view-state-"+section+"-"+selector);if($selectorTracker.val()==0){TvrUi.ajax_load_ui_data($clicked,section,selector,$selectorTracker,type,ajaxLoadMode,$renameModify,context)}else{if($selectorTracker.val()==1){$selectorTracker.val(2);TvrUi.edit_styles($clicked)}else{if($selectorTracker.val()==2){$selectorTracker.val(1);TvrUi.edit_styles($clicked)}}}}},ajax_load_ui_data:function($clicked,section,selector,$tracker,type,ajaxLoadMode,$renameModify,context){var secureNonce=$("#ui-nonce").text();var url="admin.php?page=tvr-microthemer.php";var dataString="action=tvr_microthemer_ui_load_styles&tvr_load_section="+section;dataString+="&tvr_load_type="+type;dataString+="&_wpnonce="+secureNonce;if(type=="section"){var $object=$("#section-"+section);var inputScope="all-selectors";var actionText="Edit Selectors";if(ajaxLoadMode==1){dataString+="&tvr_force_selectors=1"}if(window.TvrSharedVars.context=="visual"){var $sectionDataLoading=$("#section-data-loading");$sectionDataLoading.show()}}if(type=="selector"){var $object=$("#selector-"+section+"-"+selector);var inputScope="all-groups";var actionText="Edit Styles";dataString+="&tvr_load_selector="+selector}var $manageX=$object.find("div.manage-x");if(ajaxLoadMode==3){$manageX=$("#section-"+section).find("div.manage-x").first();if(TvrUi.selsToLoad==TvrUi.totalToLoad){$manageX.removeClass("styles-failed").addClass("styles-loading");TvrUi.update_prog_indicator("plus","Loading Style Options...")}}else{$manageX.removeClass("styles-failed").addClass("styles-loading");TvrUi.update_prog_indicator("plus","Loading Style Options...")}$.ajax({type:"GET",url:url,async:true,data:dataString,timeout:20000,error:function(x,e){$manageX.addClass("styles-failed");if(window.TvrSharedVars.context=="visual"){alert("Selector editing options could not be loaded")}},success:function(data){var $data=$(data);var insertData=$data.find("#tmp-wrap").html();$object.find("div.hidden-options").append(insertData);TvrUi.jscolor_bind(section,selector,"",inputScope);if(type=="section"){if(ajaxLoadMode==1){$("li#strk-"+section+' input[value="0"]').val(1);TvrUi.reveal_rename_section($renameModify)}else{if(ajaxLoadMode==2){$tracker.val(ajaxLoadMode);TvrUi.edit_selectors($clicked);if(window.TvrSharedVars.context=="visual"){TvrUi.enable_visual_style_options_2()}}}}else{if(type=="selector"){if(ajaxLoadMode==1){TvrUi.reveal_modify_selector($renameModify);$tracker.val(1)}else{if(ajaxLoadMode==2){TvrUi.edit_styles($clicked);$tracker.val(2)}else{if(ajaxLoadMode==3){--TvrUi.selsToLoad;if(TvrUi.selsToLoad==0){$manageX.removeClass("styles-loading");TvrUi.update_prog_indicator("minus");TvrUi.reveal_rename_section($renameModify)}$tracker.val(1)}}}}}if(context=="default_to_first_sel, load selectors visibly"){TvrUi.update_prog_indicator("minus");if(TvrUi.visualStylesEnabled){TvrUi.enable_visual_style_options()}}if(context=="enable_visual_style_options, load selectors visibly"){TvrUi.update_prog_indicator("minus");TvrUi.enable_visual_style_options_2()}if(context=="display_visual_add_sec_sel, load selectors visibly"){TvrUi.update_prog_indicator("minus");var $addNew=$("#"+TvrUi.secInFocus+"-selectors").find("div.add-sel-wrap");var $addNewLink=$addNew.find("a.reveal-add-selector");TvrUi.display_visual_add_sec_sel_2($addNew,$addNewLink,"Selector",TvrUi.intelliAfterLoad);TvrUi.intelliAfterLoad=false}if(context=="display_visual_sort, load selectors visibly"){TvrUi.update_prog_indicator("minus");var $sec=$("#"+TvrUi.secInFocus+"-selectors");var $wrap=$sec.find("div.selector-fields");var $sortButton=$sec.find("a.selectors-sortable");TvrUi.display_visual_sort_2($wrap,$sortButton,context)}TvrUi.dataLoading=false},complete:function(){if(ajaxLoadMode!=3){$manageX.removeClass("styles-loading");TvrUi.update_prog_indicator("minus")}if(window.TvrSharedVars.context=="visual"&&type=="section"){var $sectionDataLoading=$("#section-data-loading");$sectionDataLoading.hide()}}})},ajax_load_revisions_table:function($clicked){if($clicked.hasClass("already-loaded")){return false}if(window.TvrSharedVars.context=="visual"){TvrUi.update_prog_indicator("plus","Loading Revisions Table...")}var url=$clicked.attr("rel");$clicked.addClass("revisions-loading");$.ajax({type:"GET",url:url,async:true,timeout:20000,error:function(x,e){$clicked.removeClass("revisions-loading").addClass("revisions-failed")},success:function(data){var insertData=$(data).find("#tmp-wrap").html();$clicked.removeClass("revisions-loading").addClass("already-loaded");$("#revision-area").html(insertData).slideDown();if(window.TvrSharedVars.context=="visual"){TvrUi.update_prog_indicator("minus")}}})},remove_revisions_table:function(){if($("#revisions-table").length){$("#revision-area").slideUp().find("#revisions-table").remove();$("#reveal-revisions").removeClass("already-loaded")}},export_checkbox:function($clicked,$menCon,e){$("div.export-option",$menCon).slideToggle("fast")},previewcss:function($clicked,$menCon,e){e.preventDefault();if($("#save-ui-first").is(":checked")){TvrUi.ajax_save_settings("preview-css")}else{TvrUi.preview_css()}},speed_up_ui:function($clicked,$menCon){TvrUi.speedUp=true;TvrUi.close_all_ui();TvrUi.ajax_save_settings()},close_all_ui_link:function($clicked,$menCon){TvrUi.close_all_ui()},ui_reset:function($clicked,$menCon,e){var r=confirm("Are you sure you want to reset all settings? You will perminantly lose any settings you have not exported to a Micro Theme.");if(!r){e.preventDefault()}},clear_styles:function($clicked,$menCon,e){var r=confirm("Are you sure you want to clear all styles? Note: The page will reload, so please save any unsaved sections/selectors first. Also, the hand-coded CSS area won't get cleared. Please do that manually if required.");if(!r){e.preventDefault()}},restore_rev:function($clicked,e){var r=confirm("Are you sure you want to restore previous settings?");if(!r){e.preventDefault()}},ui_import:function($clicked,$menCon,e){if($("#microthemer_ui_settings_import select").val()==""){alert("Please select a theme from the list");e.preventDefault()}else{if(!$("#ui-import-overwrite").is(":checked")&&!$("#ui-import-merge").is(":checked")){alert("Please choose an import method (overwrite or merge)");e.preventDefault()}else{if($("#ui-import-overwrite").is(":checked")){var impMethod="This will OVERWRITE"}else{var impMethod="They will be MERGED with"}var r=confirm("Are you sure you want to import these settings? "+impMethod+" your current settings.");if(!r){e.preventDefault()}}}},preview_css:function(){var previewUrl=$("#previewcss").attr("href");previewUrl+="?nocache="+new Date().getTime();$.colorbox({href:previewUrl,innerHeight:"78%",innerWidth:"78%",iframe:true,open:true})},ajax_save_settings:function(context){var url=$("#fixed-menu input.ui-save").attr("rel");var $messageWrap=$("#ajax-message");var $loadingGif=$("#loading-gif");if(window.TvrSharedVars.context=="visual"){TvrUi.update_prog_indicator("plus","Saving Settings...")}else{$loadingGif.show("fast")}$messageWrap.hide();var dataString=$("#tvr_microthemer_ui_save, #tvr_microthemer_ui_save2").serialize();TvrUi.lastPostedDataString=dataString;$.ajax({type:"POST",url:url,data:dataString,timeout:20000,error:function(x,e){TvrUi.handle_ajax_error(x,e)},success:function(returnData){if(TvrUi.speedUp){location.reload()}TvrUi.remove_revisions_table();if(window.TvrSharedVars.context=="visual"){TvrUi.update_prog_indicator("minus");TvrUi.update_prog_indicator("plus","Reloading Page...");window.frames.viframe.location.reload()}else{$loadingGif.hide()}var $data=$(returnData);var message=$data.find("#microthemer-notice").html();if(message==null){var nullError=true;message="<p><b>Save Error:</b><br />Please ";message+='<a id="email-error" href="#" title="FYI, you will send Microthemer settings, browser and email and info">Email Error Report</a> to Themeover</p>';message+="<p>Reloading the page is normally a quick fix.<br /><b>Note:</b> unsaved changes may need to be re-done.</p>";message+='<form id="error-report-form" name="error_report" method="post">';message+='<textarea name="tvr_php_error">'+returnData+"</textarea>";message+='<textarea name="tvr_serialised_data">'+TvrUi.lastPostedDataString+"</textarea>";var browserInfo="";jQuery.each(jQuery.browser,function(i,val){browserInfo+=i+" : "+val+"\n"});message+='<textarea name="tvr_browser_info">'+browserInfo+"</textarea>";message+="</form>"}var new_select_option=$data.find("#sanit-export-name").text().split("|");var returnData="";var dataString="";$messageWrap.html(message+'<p><a href="#" id="hide-notification">Hide Message</a></p>').show();if(context=="preview"){context=null;TvrUi.preview_frontend("view","")}if(context=="preview-css"){context=null;TvrUi.preview_css()}if(new_select_option[0]=="yes"){var newSelOption='<option value="'+new_select_option[1]+'" selected="selected">'+TvrCom.ucwords(new_select_option[2])+"</option>";$("#fixed-menu select.export-select").append(newSelOption);$("#fixed-menu select.import-select").append(newSelOption.replace('selected="selected"',""));$("#export-new-name").hide("fast");$("#export-new-name input").val("")}if(window.TvrSharedVars.context=="visual"&&nullError){alert("Save Error: please see the message in the default view.")}}})},handle_ajax_error:function(x,e){if(x.status==0){$("#ajax-message, #loading-gif").hide();alert("Connection Error. Save Request Failed. Please Try again.")}else{if(x.status==404){$("#ajax-message, #loading-gif").hide();alert("Requested URL not found.")}else{if(x.status==500){$("#ajax-message, #loading-gif").hide();alert("Internel Server Error.")}else{if(e=="parsererror"){$("#ajax-message, #loading-gif").hide();alert("Error.\nParsing JSON Request failed.")}else{if(e=="timeout"){$("#ajax-message, #loading-gif").hide();alert("Request Timed out.")}else{$("#ajax-message, #loading-gif").hide();alert("Unknow Error.\n"+x.responseText)}}}}}},email_error_report:function($clicked,$menCon,e){var secureNonce=$("#ui-nonce").text();var url=$("#fixed-menu input.ui-save").attr("rel");url+="&action=tvr_error_email&_wpnonce="+secureNonce;var $messageWrap=$("#ajax-message");var $loadingGif=$("#loading-gif");$loadingGif.show("fast");$messageWrap.hide();var dataString=$("#error-report-form").serialize();$.ajax({type:"POST",url:url,data:dataString,timeout:20000,error:function(x,e){TvrUi.handle_ajax_error(x,e)},success:function(returnData){$loadingGif.hide();var $data=$(returnData);var message=$data.find("#microthemer-notice").html();if(message==null){message="<p><b>Mail Script Error</b></p>"}$messageWrap.html(message+'<p><a href="#" id="hide-notification">Hide Message</a></p>').show()}})},update_prog_indicator:function(action,status){var $prog=$("#progress-indicator");var $statusBoard=$("#status-board");if(action=="plus"){var sameStatus=$statusBoard.find('p[rel="'+status+'"]');if(sameStatus.length){return false}++window.TvrSharedVars.progCount;$prog.attr("title",status);if(window.TvrSharedVars.progCount==1){$prog.addClass("active");$statusBoard.html("")}$statusBoard.append('<p id="prog-'+window.TvrSharedVars.progCount+'" rel="'+status+'">'+status+"</p>")}else{--window.TvrSharedVars.progCount;if(window.TvrSharedVars.progCount==0){$statusBoard.html('<p><b>Need Help?</b> <a class="help-trigger" id="vis-help-video" href="#">View Videos</a></p><p><b>Tip:</b> Press Ctrl+S to Save</p>');$prog.removeClass("active").attr("title","Nothing in Progress")}else{$("#prog-"+window.TvrSharedVars.progCount).addClass("status-complete")}}},default_to_first_sel:function(){$("#view-states").find("input.selector-tracker").each(function(){var $curTracker=$(this);TvrUi.curSelTrackerID=$curTracker.attr("id");window.TvrSharedVars.curSelCSS=$curTracker.attr("title");TvrUi.selInFocusID=TvrUi.curSelTrackerID.replace("view-state","selector");var sectionState=$curTracker.siblings("input.section-tracker").val();if(sectionState!=2){if(sectionState=="0"){TvrUi.update_prog_indicator("plus","Loading Section Selectors...");TvrUi.dataLoading=true}TvrUi.update_view_state_tracker(TvrUi.get_edit_sels_link(),"section",2,"","default_to_first_sel, load selectors visibly")}return false})},get_edit_sels_link:function(){var tmpArray=TvrUi.selInFocusID.split("-");var secName=tmpArray[1];return $("#section-"+secName).find("a.edit-selectors")},set_initial_visual_controls:function(){TvrUi.visualTriggerSel=TvrUi.selInFocusID;var tmpArray=TvrUi.selInFocusID.split("-");var secName=tmpArray[1];var selName=tmpArray[2];TvrUi.update_section_vmenu(secName);TvrUi.update_selector_vmenu("vmenu-"+secName+"-"+selName,true);TvrUi.prevNext=TvrUi.update_visual_controls($("#"+TvrUi.curSelTrackerID));TvrUi.curSelTrackerID=""},hide_other_visual:function(excep,current){if(excep!="selector"&&TvrUi.visAddSelEnabled){TvrUi.hide_visual_add_sec_sel("Selector",current)}if(excep!="section"&&TvrUi.visAddSecEnabled){TvrUi.hide_visual_add_sec_sel("Section",current)}if(excep!="sort_section"&&TvrUi.visSecSortable){TvrUi.hide_visual_sort("Section",current)}if(excep!="sort_selector"&&TvrUi.visSelSortable){TvrUi.hide_visual_sort("Selector",current)}if(excep!="css"&&TvrUi.visRawCSS){TvrUi.hide_vis_raw_css()}if(excep!="revisions"&&TvrUi.visRevisions){TvrUi.hide_vis_revisions()}},toggle_visual_sort:function(con){if(con=="Section"){if(TvrUi.visSecSortable){TvrUi.hide_visual_sort(con,true)}else{TvrUi.display_visual_sort(con)}}else{if(TvrUi.visSelSortable){TvrUi.hide_visual_sort(con,true)}else{TvrUi.display_visual_sort(con)}}},display_visual_sort:function(con){if(con=="Section"){$("#toggle-sortable-sections").addClass("on");TvrUi.hide_other_visual("sort_section",true);var $wrap=$("#section-fields");var $sortButton=$("#sections-sortable-button")}else{$("#toggle-sortable-selectors").addClass("on");TvrUi.hide_other_visual("sort_selector",true);var viewState=$("#view-state-"+TvrUi.secInFocus+"-this").val();if(viewState=="0"){TvrUi.update_prog_indicator("plus","Loading Section Selectors");TvrUi.dataLoading=true}if(viewState!="2"){var $linkObject=$("#section-"+TvrUi.secInFocus).find("a.edit-selectors");TvrUi.update_view_state_tracker($linkObject,"section",2,"","display_visual_sort, load selectors visibly");if(TvrUi.dataLoading){return false}}var $sec=$("#"+TvrUi.secInFocus+"-selectors");var $wrap=$sec.find("div.selector-fields");var $sortButton=$sec.find("a.selectors-sortable")}if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options("fully");TvrUi.visualStylesDisabledBySort=true}TvrUi.display_visual_sort_2($wrap,$sortButton,con)},display_visual_sort_2:function($wrap,$sortButton,con){if(con=="Section"){TvrUi.sections_sortable($sortButton);TvrUi.visSecSortable=true}else{TvrUi.selectors_sortable($sortButton);TvrUi.visSelSortable=true}$("#toggle-editing").addClass("disabled");$wrap.addClass("tvr-visual").css("height",(TvrUi.frameHeight-65)+"px").slideDown("fast")},hide_visual_sort:function(con,current){if(con=="Section"){var $wrap=$("#section-fields");if(window.TvrSharedVars.totalSecs>1){TvrUi.sections_sortable($("#sections-sortable-button"))}TvrUi.visSecSortable=false;$("#toggle-sortable-sections").removeClass("on")}else{if(!current){var $sec=$("#"+TvrUi.prevSecInFocus+"-selectors")}else{var $sec=$("#"+TvrUi.secInFocus+"-selectors")}var $wrap=$sec.find("div.selector-fields");TvrUi.selectors_sortable($sec.find("a.selectors-sortable"));TvrUi.visSelSortable=false;$("#toggle-sortable-selectors").removeClass("on")}$wrap.slideUp("fast",function(){$wrap.removeClass("tvr-visual").css("height","auto").show();TvrUi.toggle_enabled_buttons()});if(TvrUi.visualStylesDisabledBySort&&window.TvrSharedVars.context=="visual"){if(TvrUi.totalSels>0){TvrUi.enable_visual_style_options()}TvrUi.visualStylesDisabledBySort=false}},toggle_raw_css:function(){if(TvrUi.visRawCSS){TvrUi.hide_vis_raw_css()}else{TvrUi.display_vis_raw_css()}},display_vis_raw_css:function(){TvrUi.hide_other_visual("css",true);var contentHeight=(TvrUi.frameHeight-45);$("#hand-css-area").addClass("tvr-visual").css("height",contentHeight+"px").slideDown("fast").find("textarea").css("height",contentHeight-35+"px");TvrUi.visRawCSS=true},hide_vis_raw_css:function(){$("#hand-css-area").slideUp("fast",function(){$(this).removeClass("tvr-visual").css("height","auto").find("textarea").css("height","500px")});TvrUi.visRawCSS=false},toggle_auto_save:function(){if(TvrUi.visAutoSave){TvrUi.disable_auto_save()}else{TvrUi.enable_auto_save()}},enable_auto_save:function(){$("#tvr-ui").delegate("input.property-input, select.property-input","change",function(){TvrUi.ajax_save_settings("save")});$("#toggle-auto-save").addClass("on");TvrUi.visAutoSave=true},disable_auto_save:function(){$("#tvr-ui").undelegate("input.property-input, select.property-input","change");$("#toggle-auto-save").removeClass("on");TvrUi.visAutoSave=false},toggle_revisions:function(){if(TvrUi.visRevisions){TvrUi.hide_vis_revisions()}else{TvrUi.display_vis_revisions()}},toggle_fixed_menu:function(){if(TvrUi.fixedMenu){TvrUi.hide_fixed_menu()}else{TvrUi.display_fixed_menu()}},display_fixed_menu:function(){$("#fixed-menu-inner").find(".fixed-subsection").show();var $innerFixed=$("#fixed-menu-inner");var curHeight=$innerFixed.height();$("#fixed-menu").animate({width:"147px",height:"auto"},300,function(){$innerFixed.css("border","1px solid #DFDFDF");$("#toggle-fixed-menu").removeClass("hid")}).removeClass("side-hid");TvrUi.fixedMenu=true},hide_fixed_menu:function(){var $innerFixed=$("#fixed-menu-inner");var curHeight=$innerFixed.height();$("#fixed-menu").animate({width:"0px",height:curHeight+"px"},300,function(){$innerFixed.css("border",0);$("#fixed-menu-inner").find(".fixed-subsection").add("#ajax-message").hide();$("#toggle-fixed-menu").addClass("hid")}).addClass("side-hid");TvrUi.fixedMenu=false},display_vis_revisions:function(){TvrUi.hide_other_visual("revisions",true);var contentHeight=(TvrUi.frameHeight-45)+"px";$("#revision-area").addClass("tvr-visual").css("height",contentHeight).slideDown("fast",function(){TvrUi.ajax_load_revisions_table($("#reveal-revisions"))});TvrUi.visRevisions=true},hide_vis_revisions:function(){$("#revision-area").slideUp("fast",function(){$(this).removeClass("tvr-visual").css("height","auto")});TvrUi.visRevisions=false},display_visual_add_sec_sel:function(con,intelli){if(con=="Section"){if(!TvrUi.allowed_action("","Add Sec")){return false}TvrUi.hide_other_visual("section",true);$("#vb-add-section").addClass("disabled");var $addNew=$("#add-new-section");var $addNewLink=$addNew.find("a.reveal-add-section")}else{var $linkObject=$("#section-"+TvrUi.secInFocus).find("a.edit-selectors");if(!TvrUi.allowed_action($linkObject,"Add Sel")){return false}TvrUi.hide_other_visual("selector",true);$("#vb-add-selector").addClass("disabled");if($("#view-state-"+TvrUi.secInFocus+"-this").val()=="0"){TvrUi.update_prog_indicator("plus","Loading Selector Controls");TvrUi.dataLoading=true;if(intelli){TvrUi.intelliAfterLoad=true}else{TvrUi.intelliAfterLoad=false}}if($linkObject.text()=="Edit Selectors"){TvrUi.update_view_state_tracker($linkObject,"section",2,"","display_visual_add_sec_sel, load selectors visibly");if(TvrUi.dataLoading){return false}}var $addNew=$("#"+TvrUi.secInFocus+"-selectors").find("div.add-sel-wrap");var $addNewLink=$addNew.find("a.reveal-add-selector")}TvrUi.display_visual_add_sec_sel_2($addNew,$addNewLink,con,intelli)},display_visual_add_sec_sel_2:function($addNew,$addNewLink,con,intelli){if($addNewLink.text()=="Add New "+con){if(con=="Section"){TvrUi.toggle_add_section($addNewLink)}else{TvrUi.toggle_add_selector($addNewLink)}}var tvrClass="tvr-visual";if(con=="Section"){TvrUi.visAddSecEnabled=true}else{if(intelli){tvrClass+=" tvr-intelli";var $newSelWizard=$("#intelli-wrap-template").clone().removeClass("template").attr("id","intelli-wrap").bind("click",function(e){var $clicked=$(e.target);var el=$clicked.prop("tagName").toLowerCase();var buttonClass=$clicked.attr("class");if(buttonClass&&buttonClass.indexOf("tvr-active")>=0){var tvrSugCSS=window.TvrSharedVars.TvrSugCSS;if(buttonClass.indexOf("tvr-parent")>=0){var $newEl=tvrSugCSS.Intelli["parent"]}else{if(buttonClass.indexOf("tvr-child")>=0){var $newEl=tvrSugCSS.Intelli["child"]}else{if(buttonClass.indexOf("tvr-prev-sibling")>=0){var $newEl=tvrSugCSS.Intelli["prev"]}else{if(buttonClass.indexOf("tvr-next-sibling")>=0){var $newEl=tvrSugCSS.Intelli["next"]}}}}window.frames.viframe.TvrExportVars.build_selector_suggestions($newEl)}});$newSelWizard.find("select").attr("id","intelli-menu").bind("change",function(e){window.TvrSharedVars.intelli_css=$(this).val();window.frames.viframe.TvrExportVars.switch_highlight("intelli");$("#"+TvrUi.secInFocus+"-selectors").find("textarea.selector-css").val($(this).val())});$addNew.find("div.new-css-selectors").prepend($newSelWizard);TvrUi.update_selector_wizard();window.TvrSharedVars.intelli=true;if(TvrUi.transWizard){$addNew.addClass("tvr-transparent").bind({mouseenter:function(){$(this).removeClass("tvr-transparent")},mouseleave:function(){$(this).addClass("tvr-transparent")}})}}TvrUi.visAddSelEnabled=true}$("#toggle-highlighting").removeClass("disabled");$addNew.addClass(tvrClass).slideDown("fast")},update_selector_wizard:function(){var $intelli=$("#intelli-wrap");var tvrSugCSS=window.TvrSharedVars.TvrSugCSS;var opts="";var ogCount=0;for(key in tvrSugCSS){if(key=="Intelli"){break}++ogCount;if(ogCount==tvrSugCSS.Intelli["ogCount"]){var labelEx=" (highest specificity)"}else{var labelEx=""}opts+='<optgroup label="'+key+labelEx+'">';for(key2 in tvrSugCSS[key]){if(window.TvrSharedVars.intelli_css==key2){var selected='selected="selected"'}else{var selected=""}opts+='<option value="'+key2+'" '+selected+" title='"+tvrSugCSS[key][key2]+"'>"+key2+"</option>"}opts+="</optgroup>"}$intelli.find("select").html(opts);$intelli.find("div.refine-target-controls span").removeClass("tvr-active");$intelli.find("div.refine-target-controls span").each(function(i){var $this=$(this);var buttonClass=$this.attr("class");if(buttonClass.indexOf("tvr-parent")>=0&&tvrSugCSS.Intelli["parent"]){$this.addClass("tvr-active")}else{if(buttonClass.indexOf("tvr-child")>=0&&tvrSugCSS.Intelli["child"]){$this.addClass("tvr-active")}else{if(buttonClass.indexOf("tvr-prev-sibling")>=0&&tvrSugCSS.Intelli["prev"]){$this.addClass("tvr-active")}else{if(buttonClass.indexOf("tvr-next-sibling")>=0&&tvrSugCSS.Intelli["next"]){$this.addClass("tvr-active")}}}}});$intelli.find("div.refine-target-html span").html(tvrSugCSS.Intelli["htmlString"]);$("#"+TvrUi.secInFocus+"-selectors").find("textarea.selector-css").val(window.TvrSharedVars.intelli_css)},hide_visual_add_sec_sel:function(con,current){if(window.TvrSharedVars.intelli){$("#intelli-wrap").remove();if(window.TvrSharedVars.highlightEnabled){TvrUi.toggle_highlighting();window.frames.viframe.TvrExportVars.switch_highlight("reg")}}if(con=="Section"){var $addNew=$("#add-new-section");$("#vb-add-section").removeClass("disabled");TvrUi.visAddSecEnabled=false}else{if(!current){var secID=TvrUi.prevSecInFocus}else{var secID=TvrUi.secInFocus}var $addNew=$("#"+secID+"-selectors").find("div.add-sel-wrap");$("#vb-add-selector").removeClass("disabled");TvrUi.visAddSelEnabled=false}$addNew.slideUp("fast",function(){if(window.TvrSharedVars.intelli){if(TvrUi.transWizard){$addNew.unbind("mouseenter mouseleave").removeClass("tvr-transparent")}window.TvrSharedVars.intelli=false}$addNew.removeClass("tvr-visual").show()})},load_visual_view:function($clicked){if(window.TvrSharedVars.context=="visual"){return false}var $body=$("body");$body.addClass("tvr-visual");TvrUi.frameHeight=($body.height()-118);TvrUi.frameWidth=$body.width();var essItems=57+67+49+49+57+57+57+57;essItems=essItems+12+12;essItems=essItems+173+173;var spaceLeft=TvrUi.frameWidth-essItems;$("#vmenu-sections").css("maxWidth",(173+Math.floor(spaceLeft*0.4))+"px");$("#vmenu-selectors-display").css("maxWidth",(173+Math.floor(spaceLeft*0.6))+"px");window.TvrSharedVars.context="visual";TvrUi.visualLastEditedSel="";TvrUi.visualStylesEnabled=true;if(TvrUi.visAutoSaveDefault){TvrUi.enable_auto_save()}TvrUi.toggle_enabled_buttons();if($clicked.attr("id")=="load-visual"){TvrUi.default_to_first_sel()}else{window.TvrSharedVars.curSelCSS=$clicked.attr("title");TvrUi.selInFocusID=$clicked.parent(".selector-wrap").attr("id");TvrUi.curSelTrackerID=TvrUi.selInFocusID.replace("selector","view-state")}if(TvrUi.totalSels>0){TvrUi.set_initial_visual_controls()}else{if(window.TvrSharedVars.totalSecs>0){TvrUi.secInFocus=$("#view-states").find("input.section-tracker:eq(0)").attr("id").replace("view-state-","").replace("-this","");TvrUi.update_selector_vmenu("vmenu-"+TvrUi.secInFocus+"-this",true)}}if(TvrUi.placeholderFrame){TvrUi.update_prog_indicator("plus","Loading WordPress Site...");$("#viframe").contents().find("body").css("height",TvrUi.frameHeight+"px");window.frames.viframe.location=$("#viframe").attr("rel");TvrUi.placeholderFrame=false}$("#v-frontend").css("height",TvrUi.frameHeight);$("#wpadminbar, #adminmenuwrap").hide();$("#visual-view").show(function(){if(window.TvrSharedVars.totalSecs<1){TvrUi.display_visual_add_sec_sel("Section")}});$("#fixed-menu").addClass("tvr-visual");if($("#ajax-message").html()==""){TvrUi.hide_fixed_menu()}},toggle_enabled_buttons:function(){var $secContingent=$("#vb-add-selector");var $selContingent=$("#vb-focus-prev, #vb-focus-next, #toggle-editing, #toggle-highlighting, #toggle-sortable-selectors");if(window.TvrSharedVars.totalSecs<1){$secContingent.addClass("disabled")}if(TvrUi.totalSels<1){$selContingent.addClass("disabled")}var noSecSels=false;var curSecSels=parseInt($("#section-"+TvrUi.secInFocus).find("span.selector-count-state").attr("rel"));if(TvrCom.hasValue(TvrUi.secInFocus)&&curSecSels<1){$("#toggle-editing, #toggle-highlighting").addClass("disabled");noSecSels=true}if(window.TvrSharedVars.totalSecs>0){$secContingent.removeClass("disabled")}if(TvrUi.totalSels>0&&!noSecSels){$selContingent.removeClass("disabled")}if(TvrUi.visSecSortable||TvrUi.visSelSortable){$("#toggle-editing").addClass("disabled")}},close_visual_view:function(){window.TvrSharedVars.context="default";var previewUrl=$("#previewurl").val();var ajaxUrl=$("#ajaxUrl").val();var thisDomain=$("#previewbutton").attr("rel");var iframeUrl=$("#viframe").contents().find("#iframe-url").attr("content");if(iframeUrl&&iframeUrl.indexOf(thisDomain)===0&&iframeUrl!=previewUrl&&iframeUrl!=""&&!TvrUi.placeholderFrame){$.get(ajaxUrl+"&tvr_microthemer_ui_preview_url="+iframeUrl,function(){$("#previewStatus").text("iframe-success")});$("#previewurl").val(iframeUrl)}if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options("fully")}TvrUi.hide_other_visual("",true);if(TvrUi.visAutoSave){TvrUi.disable_auto_save()}$("#add-new-section").removeClass("disabled");$("#wpadminbar, #adminmenuwrap").show();$("body").removeClass("tvr-visual");if(!TvrUi.fixedMenu){TvrUi.display_fixed_menu()}$("#fixed-menu").removeClass("tvr-visual");$("#visual-view").hide();if(TvrUi.totalSels>0&&TvrCom.hasValue(TvrUi.visualLastEditedSel)&&TvrCom.hasValue(TvrUi.visualTriggerSel)&&TvrUi.visualLastEditedSel!=TvrUi.visualTriggerSel&&$("#scroll-pref").attr("rel")==1){$("html, body").animate({scrollTop:($("#"+TvrUi.visualLastEditedSel).offset().top-36)},250)}else{$("html, body").animate({scrollTop:($("#"+TvrUi.visualTriggerSel).offset().top-36)},250)}},update_visual_controls:function($curSelTracker){var prevNext=new Array();prevNext[0]=$curSelTracker.prev();prevNext[1]=$curSelTracker.next();if(prevNext[0].hasClass("section-tracker")){prevNext[0]=prevNext[0].prev()}if(TvrUi.visualStylesEnabled&&!TvrUi.dataLoading&&!TvrUi.visSelSortable&&!$curSelTracker.hasClass("section-tracker")){TvrUi.enable_visual_style_options()}if(!TvrCom.hasValue(prevNext[0].attr("id"))){var $prevSec=$curSelTracker.parent("li.strk").prev("li.strk");var $prevSecLastSel=TvrUi.selectorTrackerScan($prevSec,"prev");if($prevSecLastSel&&TvrCom.hasValue($prevSecLastSel.attr("id"))){prevNext[0]=$prevSecLastSel;$("#vb-focus-prev").removeClass("disabled");var tmpArray=$prevSecLastSel.attr("id").split("-");prevNext["prev-section"]=tmpArray[2]}else{$("#vb-focus-prev").addClass("disabled");prevNext["prev-section"]=false}}else{$("#vb-focus-prev").removeClass("disabled");prevNext["prev-section"]=false}if(!TvrCom.hasValue(prevNext[1].attr("id"))){var $nextSec=$curSelTracker.parent("li.strk").next("li.strk");var $nextSecFirstSel=TvrUi.selectorTrackerScan($nextSec,"next");if($nextSecFirstSel&&TvrCom.hasValue($nextSecFirstSel.attr("id"))){prevNext[1]=$nextSecFirstSel;$("#vb-focus-next").removeClass("disabled");var tmpArray=$nextSecFirstSel.attr("id").split("-");prevNext["next-section"]=tmpArray[2]}else{$("#vb-focus-next").addClass("disabled");prevNext["next-section"]=false}}else{$("#vb-focus-next").removeClass("disabled");prevNext["next-section"]=false}return prevNext},selectorTrackerScan:function($sec,dir){if(dir=="prev"){var $prevSec=$sec;if(TvrCom.hasValue($prevSec.attr("id"))){var $prevSecLastSel=$prevSec.find("input.view-state-input").last();if(TvrCom.hasValue($prevSecLastSel.attr("id"))&&!$prevSecLastSel.hasClass("section-tracker")){return $prevSecLastSel}else{return TvrUi.selectorTrackerScan($prevSec.prev("li.strk"),dir)}}else{return false}}else{if(dir=="next"){var $nextSec=$sec;if(TvrCom.hasValue($nextSec.attr("id"))){var $nextSecFirstSel=$nextSec.find("input.view-state-input").first().next();if(TvrCom.hasValue($nextSecFirstSel.attr("id"))){return $nextSecFirstSel}else{return TvrUi.selectorTrackerScan($nextSec.next("li.strk"),dir)}}else{return false}}}},get_set_iframe:function(){var iframeName=$("#cboxLoadedContent iframe").attr("name");$("#cboxLoadedContent iframe").attr("id",iframeName);return iframeName},toggle_highlighting:function(){if(window.TvrSharedVars.highlightEnabled){window.TvrSharedVars.highlightEnabled=false;$("#toggle-highlighting").removeClass("on");window.frames.viframe.TvrExportVars.hideOverlays()}else{window.TvrSharedVars.highlightEnabled=true;$("#toggle-highlighting").addClass("on");window.frames.viframe.TvrExportVars.showOverlays()}},enable_visual_style_options:function(){if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options(false)}TvrUi.visualLastEditedSel=TvrUi.selInFocusID;var $selTracker=$("#"+TvrUi.selInFocusID.replace("selector","view-state"));var sectionState=$selTracker.siblings("input.section-tracker").val();if(sectionState!=2){if(sectionState=="0"){TvrUi.update_prog_indicator("plus","Loading Section Selectors...");TvrUi.dataLoading=true}TvrUi.update_view_state_tracker(TvrUi.get_edit_sels_link(),"section",2,"","enable_visual_style_options, load selectors visibly");if(TvrUi.dataLoading){return false}}TvrUi.enable_visual_style_options_2()},enable_visual_style_options_2:function(){var $sel=$("#"+TvrUi.selInFocusID);$sel.addClass("selector-wrap-overlay");if(TvrUi.transEditing){$sel.bind({mouseenter:function(){$(this).find("div.hidden-options").removeClass("tvr-transparent")},mouseleave:function(){if(!TvrJscolor.showing){$(this).find("div.hidden-options").addClass("tvr-transparent")}}})}var $hidden=$sel.find("div.hidden-options");$hidden.css("height",(TvrUi.frameHeight-45)+"px");if(TvrUi.transEditing){$hidden.addClass("tvr-transparent")}$("#toggle-editing").addClass("on");TvrUi.visualStylesEnabled=true},disable_visual_style_options:function(current){if(!current){var selID=TvrUi.prevSelInFocusID}else{var selID=TvrUi.selInFocusID}var $sel=$("#"+selID);$sel.removeClass("selector-wrap-overlay");if(TvrUi.transEditing){$sel.unbind("mouseleave mouseenter")}$sel.find("div.hidden-options").css("height","auto").removeClass("tvr-transparent");$("#toggle-editing").removeClass("on");TvrUi.visualStylesEnabled=false},toggle_visual_style_options:function(){if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options("fully")}else{TvrUi.enable_visual_style_options()}},insert_google_font:function(fontName){$.colorbox.close();TvrUi.gFontTarget.val(fontName).focus()},update_section_vmenu:function(secName){TvrUi.prevSecInFocus=TvrUi.secInFocus;TvrUi.secInFocus=secName;var $sevVMenu=$("#vmenu-sections");$sevVMenu.find('option:selected, option[selected="selected"]').removeAttr("selected");$sevVMenu.find("option#vmenu-"+secName).attr("selected","selected")},update_selector_vmenu:function(selVMenuID,replaceOptGroup){var $selVMenu=$("#vmenu-selectors");var $selDisplayMenu=$("#vmenu-selectors-display");var $selOption=$selVMenu.find("option#"+selVMenuID);var displayOptionID="#"+selVMenuID.replace("vmenu-","vmenu-display-");$selVMenu.find('option:selected, option[selected="selected"]').removeAttr("selected");$selOption.attr("selected","selected");if(replaceOptGroup){TvrUi.displayMenuEmpty=false;var $optGroup=$selOption.parent("optgroup").clone();$optGroup.find("option").each(function(index){if($(this).hasClass("hidden")){$(this).remove()}$(this).attr("id",$(this).attr("id").replace("vmenu-","vmenu-display-"))});$selDisplayMenu.find("optgroup").remove();$selDisplayMenu.append($optGroup);$selDisplayMenu.find(displayOptionID).attr("selected","selected")}else{$selDisplayMenu.find('option:selected, option[selected="selected"]').attr("selected","");$selDisplayMenu.find(displayOptionID).prop("selected",true)}},tvr_iterate_selectors_v:function($clicked){if($clicked.hasClass("disabled")){return false}var clickedID=$clicked.attr("id");var cClasses=$clicked.attr("class");if(clickedID=="vb-focus-prev"||clickedID=="vb-focus-next"){if(clickedID=="vb-focus-prev"){var $trackerObject=TvrUi.prevNext[0]}else{var $trackerObject=TvrUi.prevNext[1]}TvrUi.prevSelInFocusID=TvrUi.selInFocusID;TvrUi.selInFocusID=$trackerObject.attr("id").replace("view-state","selector");if(TvrUi.prevNext["next-section"]&&clickedID=="vb-focus-next"){TvrUi.update_section_vmenu(TvrUi.prevNext["next-section"])}else{if(TvrUi.prevNext["prev-section"]&&clickedID=="vb-focus-prev"){TvrUi.update_section_vmenu(TvrUi.prevNext["prev-section"])}}if((TvrUi.prevNext["prev-section"]&&clickedID=="vb-focus-prev")||(TvrUi.prevNext["next-section"]&&clickedID=="vb-focus-next")){var replaceOptGroup=true;if(TvrUi.visAddSelEnabled||TvrUi.visSelSortable){TvrUi.hide_other_visual("",false)}TvrUi.toggle_enabled_buttons()}else{var replaceOptGroup=false}var selVMenuID=$trackerObject.attr("id").replace("view-state","vmenu");TvrUi.update_selector_vmenu(selVMenuID,replaceOptGroup)}else{if(cClasses.indexOf("vmenu-sel-option")>=0){var trackerID=$clicked.attr("id").replace("vmenu-display","view-state");$trackerObject=$("#"+trackerID);TvrUi.prevSelInFocusID=TvrUi.selInFocusID;TvrUi.selInFocusID=trackerID.replace("view-state","selector")}else{if(cClasses.indexOf("vmenu-sec-option")>=0){TvrUi.prevSecInFocus=TvrUi.secInFocus;TvrUi.secInFocus=$clicked.attr("id").replace("vmenu-","");if(TvrUi.visAddSelEnabled||TvrUi.visSelSortable){TvrUi.hide_other_visual("",false)}var $secLi=$("#strk-"+TvrUi.secInFocus);var trackerID=$secLi.find("input.selector-tracker:eq(0)").attr("id");if(!TvrCom.hasValue(trackerID)){$trackerObject=$secLi.find("input.section-tracker");TvrUi.update_selector_vmenu(""+$trackerObject.attr("id").replace("view-state","vmenu"),true);if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options("fully")}TvrUi.selInFocusID=""}else{$trackerObject=$("#"+trackerID);TvrUi.update_selector_vmenu(""+trackerID.replace("view-state","vmenu"),true);TvrUi.prevSelInFocusID=TvrUi.selInFocusID;TvrUi.selInFocusID=trackerID.replace("view-state","selector")}TvrUi.toggle_enabled_buttons()}}}window.TvrSharedVars.curSelCSS=$trackerObject.attr("title");if(window.frames.viframe.TvrExportVars){window.frames.viframe.TvrExportVars.switch_highlight("reg")}TvrUi.prevNext=TvrUi.update_visual_controls($trackerObject)}};TvrUi.init();window.TvrSharedVars.custom_to_non_escaped=TvrUi.custom_to_non_escaped;window.TvrSharedVars.update_prog_indicator=TvrUi.update_prog_indicator;window.TvrSharedVars.hasValue=TvrCom.hasValue;window.TvrSharedVars.display_visual_add_sec_sel=TvrUi.display_visual_add_sec_sel;window.TvrSharedVars.update_selector_wizard=TvrUi.update_selector_wizard;window.TvrSharedVars.toggle_highlighting=TvrUi.toggle_highlighting;window.TvrSharedVars.insert_google_font=TvrUi.insert_google_font;window.TvrSharedVars.ajax_save_settings=TvrUi.ajax_save_settings});