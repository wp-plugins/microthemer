jQuery(document).ready(function($){window.TvrSharedVars={};window.TvrSharedVars.totalSecs=parseInt($("#total-sec-count").text());window.TvrSharedVars.context="default";window.TvrSharedVars.curSelCSS="#no-element";window.TvrSharedVars.TvrSugCSS={};window.TvrSharedVars.intelli_css="#no-element";window.TvrSharedVars.highlightEnabled=true;window.TvrSharedVars.tmpHighlighting=false;window.TvrSharedVars.progCount=0;window.TvrSharedVars.intelli=false;window.TvrSharedVars.cssProps=TvrCSSProps;window.TvrSharedVars.compProps={};window.TvrSharedVars.mixedElKey=0;$("#dissect-video, #pref-video").colorbox({iframe:true,innerWidth:980,innerHeight:550});var TvrCom={hasValue:function(e){if(e!=""&&e!="undefined"&&e!=undefined&&e!=null){return true}else{return false}},isDefined:function(e){if(e!==""&&e!=="undefined"&&e!==undefined&&e!==null){return true}else{return false}},ucwords:function(e){return(e+"").replace(/^([a-z])|\s+([a-z])/g,function(e){return e.toUpperCase()})},pipes_to_array:function(e){var t=new Array;var n=e.attr("rel").split("|");var r;for(r=0;r<n.length;++r){var i=n[r].split(",");t[i[0]]=parseInt(i[1])}return t},print_r:function(e,t){var n=t||"";var r=Object.prototype.toString.call(e)==="[object Array]";var i=r?"Array\n"+n+"[\n":"Object\n"+n+"{\n";for(var s in e){if(e.hasOwnProperty(s)){var o=e[s];var u="";var a=Object.prototype.toString.call(o);switch(a){case"[object Array]":case"[object Object]":u=TvrCom.print_r(o,n+"	");break;case"[object String]":u="'"+o+"'";break;default:u=o}i+=n+"	"+s+" => "+u+",\n"}}i=i.substring(0,i.length-2)+"\n"+n;return r?i+"]":i+"}"},extract_str:function(e,t){if(e=="gradient"){var n=t.split("linear-");if(n[0].indexOf("gradient")>=0){var r=n[0]}else if(n[1]&&n[1].indexOf("gradient")>=0){var r=n[1]}else{var r=""}}if(e=="bg-image"){var n=t.split("linear-");if(n[0].indexOf("url")<0){r="none"}else{var i=n[0].split("/wp-content/");var s=/micro-themes\/(.+)"?\)/.exec(i[1]);var o=s[1].split("/");r=o[1]}}return r}};var TvrUi={visAutoView:$("#auto-visual-pref").attr("rel")=="1"?true:false,visAutoSaveDefault:$("#toggle-auto-save").attr("rel")!="0-manual"?true:false,transEditing:$("#trans-editing").attr("rel")=="1"?true:false,transWizard:$("#trans-wizard").attr("rel")=="1"?true:false,visAutoSave:false,visualStylesEnabled:true,visualStylesDisabledBySort:false,visAddSecEnabled:false,visAddSelEnabled:false,visSecSortable:false,visSelSortable:false,visRawCSS:false,visRevisions:false,speedUp:false,fixedMenu:true,placeholderFrame:true,dataLoading:false,intelliAfterLoad:false,frameHeight:0,frameWidth:0,iframe_slider_set:false,mqMin:TvrCom.pipes_to_array($("#tvr-min-store")),mqMax:TvrCom.pipes_to_array($("#tvr-max-store")),mqdefaultWidth:0,displayMenuEmpty:true,totalSels:parseInt($("#total-sel-count").text()),trial:$("#plugin-trial").attr("rel")=="1"?false:true,trialNotice:"Please validate your purchase to unlock the full program! \nWith the free trial, you are limited to editing or creating 3 Sections and 9 Selectors (3 per Section).",gFontTarget:Object(),secInFocus:"",prevSecInFocus:"",selInFocusID:"",prevSelInFocusID:"",curSelTrackerID:"",visualLastEditedSel:"",visualTriggerSel:"",selsToLoad:0,totalToLoad:0,lastPostedDataString:null,typingTimer:0,doneTypingInterval:700,saveInProgress:false,reSave:false,init:function(){if(TvrUi.trial){$("#tvr-ui").delegate("div.trial-disabled a.edit-styles, div.trial-disabled a.reveal-add-selector","click",function(){alert(TvrUi.trialNotice);return false})}$(window).keypress(function(e){if(!(e.which==115&&e.ctrlKey)&&!(e.which==19))return true;e.preventDefault();return false});$(document).keydown(function(e){if(e.which==83&&e.ctrlKey==true){TvrUi.ajax_save_settings("save");e.preventDefault();return false}});var e=$("#tvr-ui");e.click(function(e){var t=$(e.target);try{n=t.attr("class");if(!n){var n="tvr-undefined"}}catch(r){}if(t.attr("id")=="load-visual"||n.indexOf("sub-options-heading")>=0){TvrUi.load_visual_view(t)}else if(n.indexOf("sections-sortable")>=0){e.preventDefault();TvrUi.sections_sortable(t)}else if(n.indexOf("selectors-sortable")>=0){e.preventDefault();TvrUi.selectors_sortable(t)}else if(n.indexOf("reveal-add-section")>=0){e.preventDefault();TvrUi.toggle_add_section(t)}else if(n.indexOf("new-section-add")>=0){TvrUi.new_section_add(t,e)}else if(n.indexOf("delete-section")>=0){TvrUi.delete_section(t,e)}else if(n.indexOf("rename-section")>=0){e.preventDefault();var i=TvrUi.get_section_meta(t);if($("#view-state-"+i["secName"]+"-this").val()==0){var s=i["secObject"].find("a.edit-selectors");var o=1;TvrUi.update_view_state_tracker(s,"section",o,t,"sec rename, load selectors discretely")}else{var u=$("li#strk-"+i["secName"]+' input[value="0"]');TvrUi.selsToLoad=u.length;TvrUi.totalToLoad=TvrUi.selsToLoad;if(TvrUi.selsToLoad>0){u.each(function(){var e=$(this).attr("id").split("-");TvrUi.ajax_load_ui_data("",e[2],e[3],$(this),"selector",3,t,"sec rename, load styles discretely")})}else{TvrUi.reveal_rename_section(t)}}}else if(n.indexOf("rename-button")>=0){TvrUi.action_rename_section(t,e)}else if(n.indexOf("edit-selectors")>=0){e.preventDefault();var o=2;TvrUi.update_view_state_tracker(t,"section",o,"","edit section selectors, load selectors visibly")}else if(n.indexOf("reveal-add-selector")>=0){e.preventDefault();TvrUi.toggle_add_selector(t)}else if(n.indexOf("add-selector")>=0){TvrUi.add_selector(t,e)}else if(n.indexOf("delete-selector")>=0){TvrUi.delete_selector(t,e)}else if(n.indexOf("modify-selector")>=0){e.preventDefault();var i=TvrUi.get_selector_meta(t);if($("#view-state-"+i["secName"]+"-"+i["selName"]).val()==0){var s=i["selObject"].find("a.edit-styles");var o=1;TvrUi.update_view_state_tracker(s,"selector",o,t,"modify selector, load styles discretely")}else{TvrUi.reveal_modify_selector(t,e)}}else if(n.indexOf("modify-button")>=0){TvrUi.action_modify_selector(t,e)}else if(n.indexOf("edit-styles")>=0){e.preventDefault();var o=2;TvrUi.update_view_state_tracker(t,"selector",o,"","edit selector styles, load styles visibly")}else if(n.indexOf("style-config")>=0){TvrUi.style_config(t,e)}else if(n.indexOf("mq-tab")>=0&&n.indexOf("active")<0){TvrUi.mq_tab_pressed(t)}else if(n.indexOf("snippet")>=0){e.preventDefault();TvrUi.load_docs(t)}else if(n.indexOf("help-trigger")>=0){TvrUi.load_docs(t)}else if(n.indexOf("bg-image-option")>=0||n.indexOf("bg-image-select")>=0){TvrUi.bg_image_option(t,e)}else if(n.indexOf("view-bg-images")>=0){TvrUi.view_bg_images(t,e)}else if(n.indexOf("hand-css-reveal")>=0){TvrUi.hand_css_reveal(t,e)}else if(n.indexOf("css-area-tab")>=0){TvrUi.update_hand_css_tab(t)}else if(n.indexOf("export-section")>=0){TvrUi.export_section_checkbox(t,e)}else if(n.indexOf("important-toggle")>=0){TvrUi.important_toggle(t,e)}else if(n.indexOf("reveal-revisions")>=0){e.preventDefault();TvrUi.ajax_load_revisions_table(t)}else if(n.indexOf("restore-link")>=0){TvrUi.restore_rev(t,e)}else if(n.indexOf("property-input")>=0){TvrUi.prop_input_click(t)}});e.dblclick(function(e){var t=$(e.target);if(t.hasClass("autofillable")){var n=t.val();var r=t.attr("rel");t.parent().parent().find('input[rel="'+r+'"]').each(function(){var e=$(this);e.attr("value",n);if(e.hasClass("color")){}TvrUi.adjust_comp_span(e,"after")});if(TvrUi.visAutoSave){TvrUi.ajax_save_settings("save")}}});$("#cboxTitle a.insert-bg").live("click",function(e){e.preventDefault();var t=$(this).attr("href");var n=$(this).attr("rel");var r=n.replace("][styles][background][background_image]","").replace("tvr_mcth[","").split("][");var i=r[0];var s=r[1];var o=$("#group-"+i+"-"+s+"-background");$('select[name="'+n+'"]',o).val(t);$.colorbox.close();var u=$("a.view-bg-images",o).attr("rel");u+=t;$("a.view-bg-images",o).attr("alt",u).attr("title",t)});$("#hand-css-area").find("textarea").tabOverride();e.delegate("select.bg-position-select","change",function(){var e=$(this);var t=e.parent(".field-wrap").siblings(".bg-position-custom");if(e.val()=="custom"){t.show("fast")}else{t.hide("fast")}});e.delegate("select.property-input:not(select.tvr-font-select), input.color","change",function(){if(TvrUi.visAutoSave){TvrUi.ajax_save_settings("save")}TvrUi.adjust_comp_span($(this),"after")});e.delegate("input.property-input","keyup",function(){if(TvrUi.visAutoSave){if(TvrUi.typingTimer){clearTimeout(TvrUi.typingTimer)}TvrUi.typingTimer=setTimeout(TvrUi.done_typing,TvrUi.doneTypingInterval)}TvrUi.adjust_comp_span($(this),"after")});e.delegate(".property-input, tr.mixed-val","mouseenter",function(){var e=$(this);if(e.hasClass("property-input")){TvrUi.adjust_comp_span(e,"hover")}if(e.hasClass("mixed-val")){window.TvrSharedVars.mixedElKey=e.attr("rel");if(!window.TvrSharedVars.highlightEnabled){window.TvrSharedVars.tmpHighlighting=true;TvrUi.toggle_highlighting()}window.frames["viframe"].TvrExportVars.switch_highlight("mixed-hover")}});e.delegate(".property-input, tr.mixed-val","mouseleave",function(){var e=$(this);if(e.hasClass("property-input")){TvrUi.adjust_comp_span(e,"after")}if(e.hasClass("mixed-val")){TvrUi.return_normal_highlighting()}});e.delegate("select.tvr-font-select","change",function(){var e=$(this);var t=e.parent(".field-wrap").siblings(".tvr-font-custom");TvrUi.gFontTarget=e.parent("div.field-wrap").siblings(".tvr-font-custom").find(".property-input");if(e.val()=="Google Font..."){t.show("fast");$.colorbox({href:$("#fonts-api").attr("rel"),innerHeight:"80%",innerWidth:"95%",fixed:true,iframe:true,open:true});TvrUi.font_changed(TvrUi.gFontTarget)}else{TvrUi.gFontTarget.val("").prop("val","");t.hide();TvrUi.font_changed(e)}});var t=$("#fixed-menu");t.click(function(e){var n=$(e.target);try{r=n.attr("class");if(!r){var r="tvr-undefined"}}catch(i){}if(r.indexOf("export-checkbox")>=0&&n.is("input")){TvrUi.export_checkbox(n,t,e)}else if(n.attr("id")=="previewbutton"){TvrUi.previewbutton(n,t,e)}else if(n.attr("id")=="previewcss"){TvrUi.previewcss(n,t,e)}else if(n.attr("id")=="speed-up"){e.preventDefault();TvrUi.speed_up_ui(n,t)}else if(n.attr("id")=="close-all-ui"){e.preventDefault();TvrUi.close_all_ui_link(n,t)}else if(n.attr("id")=="ui-reset"){TvrUi.ui_reset(n,t,e)}else if(n.attr("id")=="clear-styles"){TvrUi.clear_styles(n,t,e)}else if(n.attr("id")=="ui-import"){TvrUi.ui_import(n,t,e)}else if(n.attr("id")=="email-error"){e.preventDefault();TvrUi.email_error_report(n,t,e)}else if(n.attr("id")=="toggle-fixed-menu"){TvrUi.toggle_fixed_menu()}});$("select.export-select",t).change(function(e){$(this).attr("title",$("select.export-select option:selected",t).text());if($(this).val()=="new"){$("#export-new-name").show("fast")}else{$("#export-new-name").hide("fast")}});$("select.import-select",t).change(function(e){if($(this).val()!=""){$("#overwrite-merge").show("fast")}else{$("#overwrite-merge").hide("fast")}});$("a#hide-notification").live("click",function(e){e.preventDefault();$("#ajax-message").hide("fast")});$("#tvr_microthemer_ui_save2").submit(function(e){e.preventDefault();TvrUi.ajax_save_settings("save")});$visCon=$("#visual-view");$visCon.click(function(e){var t=$(e.target);try{n=t.attr("class");if(!n){var n="tvr-undefined"}}catch(r){}if(t.parent("div").attr("id")=="scroll-buttons"){TvrUi.tvr_iterate_selectors_v(t)}else if(t.attr("id")=="vb-add-section"&&!t.hasClass("disabled")){TvrUi.display_visual_add_sec_sel("Section")}else if(t.attr("id")=="vb-add-selector"&&!t.hasClass("disabled")){TvrUi.display_visual_add_sec_sel("Selector")}else if(t.attr("id")=="toggle-editing"&&!t.hasClass("disabled")){TvrUi.toggle_visual_style_options()}else if(t.attr("id")=="toggle-highlighting"&&!t.hasClass("disabled")){TvrUi.toggle_highlighting()}else if(t.attr("id")=="toggle-auto-save"){TvrUi.toggle_auto_save()}else if(t.attr("id")=="tvr-popup-menu"){TvrUi.hide_other_visual("",true)}else if(t.attr("id")=="toggle-sortable-sections"){TvrUi.toggle_visual_sort("Section")}else if(t.attr("id")=="toggle-sortable-selectors"){TvrUi.toggle_visual_sort("Selector")}else if(t.attr("id")=="toggle-raw-css"){TvrUi.toggle_raw_css()}else if(t.attr("id")=="toggle-revisions"){TvrUi.toggle_revisions()}else if(t.attr("id")=="show-tutorials"||t.attr("id")=="vis-help-video"){TvrUi.load_docs(t)}else if(n.indexOf("v-mq-button")>=0&&n.indexOf("active")<0){TvrUi.update_mq_button(t)}else if(t.attr("id")=="close-visual"){TvrUi.close_visual_view()}});$("#vmenu-sections, #vmenu-selectors-display").change(function(e){var t=$(this).find("option:selected");TvrUi.tvr_iterate_selectors_v(t)});if(TvrUi.visAutoView){TvrUi.load_visual_view($("#load-visual"))}},strk_mirror_order:function(e,t){if(t=="section"){var n=$(e.item);var r=n.prev();var i=n.attr("id").replace("section-","");if(r.attr("id")==undefined){$("li#strk-"+i).detach().prependTo("ul#view-states");$("#vmenu-"+i).detach().prependTo($("#vmenu-sections").find("optgroup"));$("#vmenu-selectors").find('optgroup[rel="'+i+'"]').detach().prependTo("#vmenu-selectors")}else{var s=r.attr("id").replace("section-","");$("li#strk-"+i).detach().insertAfter("li#strk-"+s);$("#vmenu-"+i).detach().insertAfter("#vmenu-"+s);$("#vmenu-selectors").find('optgroup[rel="'+i+'"]').detach().insertAfter($("#vmenu-selectors").find('optgroup[rel="'+s+'"]'))}}else if(t=="selector"){var o=$(e.item);var u=o.prev();var a=TvrUi.get_selector_meta(o,"this");var f=$("#view-state-"+a["secName"]+"-"+a["selName"]);var l=$("#vmenu-"+a["secName"]+"-"+a["selName"]);var c=$("li#strk-"+a["secName"]+" input:first");if(u.attr("id")==undefined){f.detach().insertAfter(c);$(l).detach().prependTo($("#vmenu-selectors").find('optgroup[rel="'+a["secName"]+'"]'));if(a["secName"]==TvrUi.secInFocus){var h=$("#vmenu-display-"+a["secName"]+"-"+a["selName"]);$(h).detach().prependTo($("#vmenu-selectors-display").find("optgroup"))}}else{var p=TvrUi.get_selector_meta(u,"this");f.detach().insertAfter("#view-state-"+p["secName"]+"-"+p["selName"]);$(l).detach().insertAfter($("#vmenu-"+p["secName"]+"-"+p["selName"]));if(a["secName"]==TvrUi.secInFocus){var h=$("#vmenu-display-"+a["secName"]+"-"+a["selName"]);$(h).detach().insertAfter($("#vmenu-display-"+p["secName"]+"-"+p["selName"]))}}}},sections_sortable:function(e){if(e.text()=="Enable Sortable Sections"){TvrUi.close_all_ui();$("#tvr-ui div.section-fields").addClass("sortable-sections").sortable({update:function(e,t){TvrUi.strk_mirror_order(t,"section")}});e.text("Disable Sortable Sections");$("#tvr-ui a.edit-selectors").each(function(){$(this).fadeOut("slow",function(){$(this).after('<span class="disabled-message">Sections Are Sortable</span>')})})}else if(e.text()=="Disable Sortable Sections"){$("#tvr-ui div.section-fields").removeClass("sortable-sections").sortable("destroy");e.text("Enable Sortable Sections");$("#tvr-ui span.disabled-message").each(function(){$(this).fadeOut("slow",function(){$(this).remove();$("#tvr-ui a.edit-selectors").show()})})}},selectors_sortable:function(e){var t=e.attr("rel");var n=$("#"+t+"-selectors");if(e.text()=="Enable Sortable Selectors"){$("div.hidden-options",n).hide();$("#strk-"+t+' input.selector-tracker[value="2"]').val(1);$("div.selector-fields",n).addClass("sortable-selectors").sortable({update:function(e,t){TvrUi.strk_mirror_order(t,"selector")}});e.text("Disable Sortable Selectors");$("a.edit-styles",n).each(function(){$(this).fadeOut("slow",function(){$(this).after('<span class="disabled-message">Selectors Are Sortable</span>')})})}else if(e.text()=="Disable Sortable Selectors"){$("div.selector-fields",n).removeClass("sortable-selectors").sortable("destroy");e.text("Enable Sortable Selectors");$("span.disabled-message",n).each(function(){$(this).fadeOut("slow",function(){$(this).remove();$("a.edit-styles",n).show()})})}},toggle_add_section:function(e,t){if(!TvrUi.allowed_action(e,"Add Sec")){return false}e.parent().siblings("div.new-section").slideToggle();if(e.text()=="Add New Section"){e.text("Cancel")}else{if(window.TvrSharedVars.context=="visual"){TvrUi.hide_visual_add_sec_sel("Section",true)}e.text("Add New Section")}},new_section_add:function(e,t){var n=e.siblings("input.new-section-input").val();if(n==""){alert("Please enter a value for Section Name");return false}n=TvrUi.sanitise_section(n);var r=n.replace(/ /g,"_").toLowerCase();var i=$("div#section-template").clone().removeClass("template").removeClass("section-template").attr("id","section-"+r);var s=i.find("h2").html().replace("<input",n+"<input");i.find("h2").html(s);i.find("a.delete-section").attr("rel",r);i.find(".rename-input").val(n);i.find(".hidden-options, .add-selector, .rename-button").each(function(e){$(this).attr("id",$(this).attr("id").replace("selector_section",r))});i.find("input").each(function(e){$(this).attr("name",$(this).attr("name").replace("[selector_section]","["+r+"]"))});$("#section-fields").append(i);$("#section-"+r).hide().fadeIn("fast",function(){e.parent("div.new-section").slideUp();e.siblings("input.new-section-input").val("");$("#tvr-ui .reveal-add-section").text("Add New Section");var t=$("#section-count-state");TvrUi.update_count(t,"add",1,"section");$("#view-states").append('<li id="strk-'+r+'" class="strk"><input type="hidden" id="view-state-'+r+'-this" class="view-state-input section-tracker" name="tvr_mcth[non_section][view_state]['+r+'][this]" title="" rel="" value="1" /></li>');$("#vmenu-sections").find("optgroup").append('<option id="vmenu-'+r+'" class="vmenu-sec-option" selected="selected">'+n+"</option>");var i='<optgroup rel="'+r+'" label="'+n+'"><option id="vmenu-'+r+'-this" class="vmenu-sel-option hidden" title=""></option></optgroup>';$("#vmenu-selectors").append(i);if(window.TvrSharedVars.context=="visual"){TvrUi.tvr_iterate_selectors_v($("#vmenu-"+r));TvrUi.hide_visual_add_sec_sel("Section",true)}})},delete_section:function(e,t){t.preventDefault();var n=e.attr("rel");var r=$("#section-"+n);var i=$("span.selector-count-state",r).attr("rel");var s=$("a.edit-selectors",r);if(i>0){var o=confirm("This section contains CSS selectors. Are you sure you want to delete it?");if(o==true){TvrUi.delete_section_2(r,n)}}else{TvrUi.delete_section_2(r,n)}},delete_section_2:function(e,t){e.fadeOut("fast",function(){var n=e.find("span.selector-count-state").attr("rel");e.remove();var r=$("#section-count-state");TvrUi.update_count(r,"subtract",1,"section",n);$vmenuItem=$("#vmenu-"+t);var i=$vmenuItem.next(".vmenu-sec-option");var s=$vmenuItem.prev(".vmenu-sec-option");$vmenuItem.remove();$("#vmenu-selectors, #vmenu-selectors-display").find('optgroup[rel="'+t+'"]').remove();$("li#strk-"+t).remove();if(window.TvrSharedVars.context=="visual"){if(t==TvrUi.secInFocus){if(TvrCom.hasValue(i.attr("id"))){var o=i}else if(TvrCom.hasValue(s.attr("id"))){var o=s}else{var u=true}if(!u){TvrUi.tvr_iterate_selectors_v(o)}}else{TvrUi.prevNext=TvrUi.update_visual_controls($("#"+TvrUi.selInFocusID.replace("selector","view-state")))}}TvrUi.clean_global_vars("del","Section",t)})},clean_global_vars:function(e,t,n,r){if(e=="del"){if(t=="Section"){if(n==TvrUi.prevSecInFocus){TvrUi.prevSecInFocus=""}}var i="selector-"+n;if(TvrUi.prevSelInFocusID.indexOf(i)>=0){TvrUi.prevSelInFocusID=""}if(TvrUi.visualLastEditedSel&&TvrUi.visualLastEditedSel.indexOf(i)>=0){TvrUi.visualLastEditedSel=""}if(TvrUi.visualTriggerSel.indexOf(i)>=0){TvrUi.visualTriggerSel=""}}else if(e=="rename"){var i="selector-"+n;var s="selector-"+r;if(t=="Section"){if(n==TvrUi.secInFocus){TvrUi.secInFocus=TvrUi.secInFocus.replace(n,r)}if(n==TvrUi.prevSecInFocus){TvrUi.prevSecInFocus=TvrUi.prevSecInFocus.replace(n,r)}i+="-";s+="-"}if(t=="Selector"&&i==TvrUi.selInFocusID||t=="Section"){TvrUi.selInFocusID=TvrUi.selInFocusID.replace(i,s)}if(t=="Selector"&&i==TvrUi.prevSelInFocusID||t=="Section"){TvrUi.prevSelInFocusID=TvrUi.prevSelInFocusID.replace(i,s)}if(t=="Selector"&&i==TvrUi.visualLastEditedSel||t=="Section"){TvrUi.visualLastEditedSel=TvrUi.visualLastEditedSel.replace(i,s)}if(t=="Selector"&&i==TvrUi.visualTriggerSel||t=="Section"){TvrUi.visualTriggerSel=TvrUi.visualTriggerSel.replace(i,s)}}},reveal_rename_section:function(e){e.siblings("div.rename").slideToggle();if(e.text()=="Rename Section"){e.text("Cancel")}else{e.text("Rename Section")}},action_rename_section:function(e,t){var n=e.prev("input.rename-input").val();if(n==""){alert("Please enter a value for Section Name");return false}n=n.replace(/[^a-zA-Z0-9 ]+/g,"").replace("/ {2,}/"," ");var r=TvrCom.ucwords(n);n=n.replace(/ /g,"_").toLowerCase();var i=e.attr("id").replace("-rename","");var s=i.replace(/\_/g," ");s=TvrCom.ucwords(s);var o=$("#section-"+i);$("input, select",o).each(function(e){$(this).attr("name",$(this).attr("name").replace("tvr_mcth["+i+"]","tvr_mcth["+n+"]").replace(/tvr_mcth\[non_section\]\[m_query\]\[([a-zA-Z0-9]+)\]\[([a-zA-Z0-9_]+)\]/,"tvr_mcth[non_section][m_query][$1]["+n+"]").replace("export_sections["+i+"]","export_sections["+n+"]").replace("rename_section["+i+"]","rename_section["+n+"]").replace("rename_button["+i+"]","rename_button["+n+"]").replace("tvr_mcth[non_section][important]["+i+"]","tvr_mcth[non_section][important]["+n+"]"))});var u=$("#vmenu-"+i);var a=$("#vmenu-selectors, #vmenu-selectors-display").find('optgroup[rel="'+i+'"]');var f=u.text().replace(s,r);u.text(f);a.attr("label",r);$("input.rename-button, div.hidden-options, input.add-selector, input.modify-button, div.selector-wrap, div.tvr-ui-right",o).add(u).add(a.find("option")).each(function(){try{$(this).attr("id",$(this).attr("id").replace(i,n))}catch(e){}});$("a.delete-selector, a.delete-section, a.selectors-sortable",o).add(a).each(function(e){$(this).attr("rel",$(this).attr("rel").replace(i,n))});var l=$("li#strk-"+i);$("input.view-state-input",l).each(function(e){$(this).attr("id",$(this).attr("id").replace(i,n));$(this).attr("name",$(this).attr("name").replace("tvr_mcth[non_section][view_state]["+i+"]","tvr_mcth[non_section][view_state]["+n+"]"))});l.attr("id",$("li#strk-"+i).attr("id").replace(i,n));o.attr("id","section-"+n);o=$("#section-"+n);e.parent(".rename").slideUp("fast",function(){$("a.rename-section",o).text("Rename Section");var e=$("h2.main-options-heading",o).html().replace(s,r);$("h2.main-options-heading",o).html(e);TvrUi.clean_global_vars("rename","Section",i,n)})},edit_selectors:function(e){e.parent().parent().siblings("div.hidden-options").toggle();if(e.text()=="Edit Selectors"){e.text("Hide Selectors")}else{e.text("Edit Selectors")}},allowed_action:function(e,t){if(!TvrUi.trial){return true}if(t=="Add Sec"){if(window.TvrSharedVars.totalSecs>2){var n=true}}if(t=="Add Sel"){var r=TvrUi.get_section_meta(e);var i=parseInt(r["secObject"].find("span.selector-count-state").attr("rel"));if(i>2){var n=true}}if(n){alert(TvrUi.trialNotice);return false}else{return true}},toggle_add_selector:function(e){if(!TvrUi.allowed_action(e,"Add Sel")){return false}e.siblings("div.new-css-selectors").slideToggle();if(e.text()=="Add New Selector"){e.text("Cancel")}else{if(window.TvrSharedVars.context=="visual"){TvrUi.hide_visual_add_sec_sel("Selector",true);if(window.parent.TvrSharedVars.intelli){e.siblings("div.new-css-selectors").find("textarea.selector-css, input.selector-label").val("");TvrUi.toggle_enabled_buttons()}}e.text("Add New Selector")}},add_selector:function(e,t){var n=e.siblings("input.selector-label").val();var r=e.parent().siblings(".new-css-selector-wrap").children("textarea.selector-css").val();if(r.indexOf("{")>=0&&n.indexOf("{}")<0){n="{} "+n}var i=TvrUi.custom_escape_quotes(r);if(n==""||i==""){alert("Please enter a value for CSS Selector and Label");return false}var s=TvrUi.sanitise_selector_label(n);var o=e.attr("id").replace("-add","");var u=$("div#selector-template").clone().removeClass("template").removeClass("selector-template").attr("id","selector-"+o+"-"+s);u.find("input.selector-label").attr("name","tvr_mcth["+o+"]["+s+"][label]").attr("value",n+"|"+i);u.find("input.radio").attr("name","tvr_mcth["+o+"]["+s+"][pie]");u.find("input.register-selector").attr("name","tvr_mcth["+o+"]["+s+"]");u.find("h3").text(n).attr("title",r);u.find("textarea.modify-input-css").val(r).attr("title",r);u.find("input.modify-input-label").val(n);u.find("a.delete-selector").attr("rel",o+"|"+s);u.find("div.tvr-ui-right, .modify-button").each(function(e){$(this).attr("id",$(this).attr("id").replace("selector_section",o).replace("selector_css",s))});u.find("input.style-config, input.register-group, input.device-focus").each(function(e){$(this).attr("name",$(this).attr("name").replace("selector_section",o).replace("selector_css",s))});$("#"+o+"-selectors div.selector-fields").append(u);$("#selector-"+o+"-"+s).hide().fadeIn("fast",function(){e.parents("div.new-css-selectors").slideUp();e.siblings("input.selector-label").val("");e.parent().siblings(".new-css-selector-wrap").children("textarea.selector-css").val("");$("#section-"+o+" a.reveal-add-selector").text("Add New Selector");var t=$("#section-"+o).find(".selector-count-state");TvrUi.update_count(t,"add",1,"selector");$("#strk-"+o).append('<input type="hidden" id="view-state-'+o+"-"+s+'" class="view-state-input selector-tracker" name="tvr_mcth[non_section][view_state]['+o+"]["+s+']" title="'+i+'" rel="'+n+'" value="1" />');$("#vmenu-selectors").find('optgroup[rel="'+o+'"]').append('<option id="vmenu-'+o+"-"+s+'" title="'+TvrUi.custom_to_regular_escape(i)+'" class="vmenu-sel-option" selected="selected">'+n+"</option>");$("#vmenu-selectors-display").find("optgroup").append('<option id="vmenu-display-'+o+"-"+s+'" title="'+TvrUi.custom_to_regular_escape(i)+'" class="vmenu-sel-option" selected="selected">'+n+"</option>");if(window.TvrSharedVars.context=="visual"){TvrUi.tvr_iterate_selectors_v($("#vmenu-display-"+o+"-"+s));TvrUi.hide_visual_add_sec_sel("Selector",true);if(!TvrUi.visualStylesEnabled){TvrUi.enable_visual_style_options()}}})},delete_selector:function(e,t){t.preventDefault();var n=e.attr("rel").split("|");var r=n[0];var i=n[1];var s=$("#section-"+r).find(".selector-count-state");var o=$("#selector-"+r+"-"+i);var u=parseInt($("span.style-count-state",o).attr("rel"));var a=$("a.edit-styles",o);if(u>0){var f=confirm("This CSS selector contains active styles. Are you sure you want to delete it?");if(f==true){TvrUi.delete_selector_2(o,r,i,s)}}else{TvrUi.delete_selector_2(o,r,i,s)}},delete_selector_2:function(e,t,n,r){e.fadeOut("fast",function(){e.remove();TvrUi.update_count(r,"subtract",1,"selector");$("#view-state-"+t+"-"+n).remove();$("#vmenu-display-"+t+"-"+n+", #vmenu-"+t+"-"+n).remove();if(window.TvrSharedVars.context=="visual"){if("selector-"+t+"-"+n==TvrUi.selInFocusID){if(TvrUi.totalSels==0){return false}if(!$("#vb-focus-next").hasClass("disabled")){if(!TvrUi.prevNext["next-section"]){var i=$("#vb-focus-next")}else if(!TvrUi.prevNext["prev-section"]){var i=$("#vb-focus-prev")}else{var i=$("#vb-focus-next")}}else if(!$("#vb-focus-prev").hasClass("disabled")){var i=$("#vb-focus-prev")}else{}TvrUi.tvr_iterate_selectors_v(i)}else{TvrUi.prevNext=TvrUi.update_visual_controls($("#"+TvrUi.selInFocusID.replace("selector","view-state")))}}});TvrUi.clean_global_vars("del","Selector",t+"-"+n)},reveal_modify_selector:function(e,t){e.parent().siblings("div.modify").slideToggle();if(e.text()=="Modify Selector"){e.text("Cancel")}else{e.text("Modify Selector")}},action_modify_selector:function(e,t){var n=e.siblings("input.modify-input-label").val();var r=e.parent().siblings(".css-selector-wrap").children("textarea.modify-input-css").val();if(r.indexOf("{")>=0&&n.indexOf("{}")<0){n="{} "+n}else{if(r.indexOf("{")<0){n=n.replace("{} ","");e.siblings("input.modify-input-label").val(n)}}var i=TvrUi.custom_escape_quotes(r);window.TvrSharedVars.curSelCSS=i;if(n==""||i==""){alert("Please enter a value for CSS Selector and Label");return false}var s=TvrUi.sanitise_selector_label(n);var o=e.attr("id").split("-modify-");var u=o[0];var a=o[1];var f=$("#selector-"+u+"-"+a);$("input.selector-label",f).attr("value",n+"|"+i);$("input, select",f).each(function(e){$(this).attr("name",$(this).attr("name").replace(/tvr_mcth\[non_section\]\[m_query\]\[([a-zA-Z0-9]+)\]\[([a-zA-Z0-9_]+)\]\[([a-zA-Z0-9_]+)\]/,"tvr_mcth[non_section][m_query][$1][$2]["+s+"]").replace("tvr_mcth["+u+"]["+a+"]","tvr_mcth["+u+"]["+s+"]").replace("tvr_mcth[non_section][important]["+u+"]["+a+"]","tvr_mcth[non_section][important]["+u+"]["+s+"]"))});$("input.modify-button, div.tvr-ui-right",f).each(function(e){$(this).attr("id",$(this).attr("id").replace(u+"-modify-"+a,u+"-modify-"+s).replace("group-"+u+"-"+a,"group-"+u+"-"+s))});$("a.delete-selector",f).each(function(e){$(this).attr("rel",$(this).attr("rel").replace(u+"|"+a,u+"|"+s))});var l=$("#view-state-"+u+"-"+a);l.attr("name",l.attr("name").replace("["+u+"]["+a+"]","["+u+"]["+s+"]")).attr("id",l.attr("id").replace("view-state-"+u+"-"+a,"view-state-"+u+"-"+s)).attr("rel",n).attr("title",i);var c=$("#vmenu-"+u+"-"+a+", #vmenu-display-"+u+"-"+a);c.each(function(){$(this).attr("id",$(this).attr("id").replace("-"+u+"-"+a,"-"+u+"-"+s)).text(n).attr("title",r)});f.attr("id","selector-"+u+"-"+s);f=$("#selector-"+u+"-"+s);$("div.modify",f).slideUp("fast",function(){$("a.modify-selector",f).text("Modify Selector");$("h3.sub-options-heading",f).text(n).attr("title",r);$("textarea.modify-input-css",f).attr("title",r);TvrUi.clean_global_vars("rename","Selector",u+"-"+a,u+"-"+s);window.frames["viframe"].TvrExportVars.switch_highlight("reg");if(TvrUi.visAutoSave){TvrUi.ajax_save_settings("save")}})},edit_styles:function(e){if(window.TvrSharedVars.context=="visual"){e.parent().parent().siblings("div.hidden-options").slideToggle("fast")}else{e.parent().parent().siblings("div.hidden-options").toggle()}if(e.text()=="Edit Styles"){e.text("Hide Styles");TvrUi.refresh_comp_css()}else{e.text("Edit Styles")}},update_hand_css_tab:function(e){$("#css-tab-areas").find("span").removeClass("active");e.addClass("active");$("#hand-css-area").find("textarea.show").removeClass("show");$("#"+e.attr("rel")).addClass("show")},mq_tab_pressed:function(e){var t=e.parents(".tvr-ui-right");var n=e.attr("rel");TvrUi.update_mq_tab(n,t)},update_mq_tab:function(e,t){var n=t.find("div.query-tabs");n.find("span.mq-tab").removeClass("active").end().find("span.tab-mq-"+e).addClass("active").end().find("input.device-focus").val(e);t.find("div.property-fields.show").removeClass("show").end().find("div.property-mq-"+e).addClass("show");TvrUi.update_mq_button($("#mq-button-"+e))},update_iframe_slider:function(e,t){if(e&&!t){var n=e}else if(t){var n=t}else{var n=TvrUi.frameWidth}$("#v-frontend").width(n);$("#iframe-pixel-width").text(n+"px");if(e){$("#iframe-min-width").text("min: "+e+"px");var r=e}else{$("#iframe-min-width").text("");var r=0}if(t){$("#iframe-max-width").text("max: "+t+"px");var i=t}else{$("#iframe-max-width").text("");var i=TvrUi.frameWidth}$("#v-mq-slider").slider({min:r,max:i,value:n,start:function(e,t){if(window.TvrSharedVars.highlightEnabled){TvrUi.toggle_highlighting()}},slide:function(e,t){var n=$("#v-mq-slider").slider("option","value");$("#v-frontend").width(n);$("#iframe-pixel-width").text(n+"px")},change:function(e,t){window.frames["viframe"].TvrExportVars.switch_highlight("reg");TvrUi.refresh_comp_css()}});TvrUi.iframe_slider_set=true},update_mq_button:function(e){var t=e.attr("rel");$("#v-mq-buttons").find("span.active").removeClass("active");e.addClass("active");TvrUi.update_iframe_slider(TvrUi.mqMin[t],TvrUi.mqMax[t])},map_formatted_comp:function(e,t,n,r,i,s,o,u){if(n=="straight"){if(t=="var"){window.TvrSharedVars.compProps[e[r]]=s}else{if(i==0){window.TvrSharedVars.compProps[e[r]]=[]}window.TvrSharedVars.compProps[e[r]][i]=[];window.TvrSharedVars.compProps[e[r]][i]["val"]=s;window.TvrSharedVars.compProps[e[r]][i]["htmlString"]=o}}if(n=="array"){var a=-1;var f=e[r];for(var l in f){if(t=="var"){window.TvrSharedVars.compProps[f[l]]=u[++a]}else{if(i==0){window.TvrSharedVars.compProps[f[l]]=[]}window.TvrSharedVars.compProps[f[l]][i]=[];window.TvrSharedVars.compProps[f[l]][i]["val"]=u[++a];window.TvrSharedVars.compProps[f[l]][i]["htmlString"]=o}}}},format_exceptions:function(e,t,n,r,i){if(i=="var"){var s=n}else{var s=n[r]["val"];var o=n[r]["htmlString"]}if(t=="font-family"||t=="list-style-type"||t=="border-top-left-radius"||t=="border-top-right-radius"||t=="border-bottom-right-radius"||t=="border-bottom-left-radius"){TvrUi.map_formatted_comp(e,i,"straight",t,r,s,o,[])}else if(t=="text-shadow"||t=="box-shadow"){var u=s.split(" ");if(u.length<2){u[1]=u[2]=u[3]=0}TvrUi.map_formatted_comp(e,i,"array",t,r,s,o,u)}else if(t=="background-img-full"){var a=[];a[0]=TvrCom.extract_str("bg-image",s);var f=TvrCom.extract_str("gradient",s);if(f){var l=/gradient\((.+)\)/.exec(f);var c=l[1].split(", ");if(s.indexOf("webkit")>=0){var h="webkit-";var p=" (webkit standard)"}else{var h="";var p=""}if(c[0].indexOf("deg")>-1){var d=e["keys"][h+"gradient-angle"][c[0]];var v=true;var m=1}else{var d="top to bottom";var v=false;var m=0}if(d){a[1]=d}else{a[1]=c[0]+p}a[2]=c[m];if(v&&c.length>3||!v&&c.length>2){var g=c[++m].split(" ");a[3]=g[0];a[4]=g[1];a[5]=c[++m]}else{a[3]="none";a[4]="0";a[5]=c[++m]}}else{a[1]="none";a[2]="none";a[3]="0";a[4]="none";a[5]="none"}TvrUi.map_formatted_comp(e,i,"array",t,r,s,o,a)}else if(t=="background-position"){var y=s.split(", ");var b=y[0].split(" ");var w=e["keys"]["background-position-x"][b[0]];var E=e["keys"]["background-position-y"][b[1]];var S=w?w:b[0];var x=E?E:b[1];var T=S+" "+x;var N=[S,x];TvrUi.map_formatted_comp(e,i,"straight",t,r,T,o,[]);TvrUi.map_formatted_comp(e,i,"array","background-position-custom",r,s,o,N)}else if(t=="background-repeat"||t=="background-attachment"){var y=s.split(", ");TvrUi.map_formatted_comp(e,i,"straight",t,r,y[0],o,[])}},refresh_comp_css:function(){var e=window.TvrSharedVars.compProps;var t=TvrPropExceptions;var n=$("#"+TvrUi.selInFocusID);var r=0;for(var i in e){++r;var s=e[i];if(s===Object(s)){for(var o in s){TvrUi.format_exceptions(t,i,s,o,"obj")}}else{TvrUi.format_exceptions(t,i,s,"","var")}}if(r<1){var u="This Selector doesn't target any elements on the current page";n.find("input.property-input, select.property-input").attr("title",u);n.find("div.field-wrap").removeClass("mixed-cp").find("span.comp-style").text("N/A");return}n.find("div.field-wrap").each(function(e){var t=$(this);var n=t.find("span.comp-style");var r=t.find("input.property-input, select.property-input");var i=n.attr("class").split(" ");var s=i[1].replace("cprop-","");var o=window.TvrSharedVars.compProps[s];var u=0;if(TvrCom.isDefined(o)){if(o===Object(o)){t.addClass("mixed-cp");n.text("[mixed]");var a="The computed value for this style varies across multiple elements on the current page";var f="";for(var l in o){if(!TvrCom.isDefined(o[l]["val"])){continue}var c=o[l]["htmlString"].replace("&#60;","<").replace("&#62;",">");f+='<tr class="mixed-val" rel="'+u+'"><td>'+ ++u+"</td><td title='"+c+"'>"+TvrUi.colorize_hash(o[l]["val"],t,"obj")+"</td></tr>"}n.next("span.comp-mixed-table").find("tbody").html(f)}else{var a="Computed value: "+o;t.removeClass("mixed-cp");n.html(TvrUi.colorize_hash(o,t,"val"))}}else{var a="Style not applicable";n.text("")}r.attr("title",a)})},colorize_hash:function(e,t,n){if(!e||e.indexOf("#")<0){if(n!="obj"){t.removeClass("colorize-hash")}return e}else{if(n!="obj"){t.addClass("colorize-hash")}var r=e;return e.replace("#",'<span class="colored-hash" style="background:'+r+'">#</span>')}},prop_input_click:function(e){},style_config:function(e,t){$area=e.parents("div.row");if(e.hasClass("mq-toggle")){var n="mq";var r=e.attr("rel").split("|");var i=r[0];var s=r[1];var o="-mq-"+i}else{var n="reg";var i="all-devices";var s="";var o="-mq-all-devices";if(e.hasClass("all-toggle")){n="all"}}if(n=="reg"){u=e}else{var u=$area.find("input.main-checkbox")}var a=$area.find('span.property-group-state[rel="on"]').length;var f=e.val();var l=TvrUi.get_selector_meta(e);var c=l["secName"];var h=l["selName"];var p=l["selObject"];var d=p.find("span.style-count-state");var v=$("#group-"+c+"-"+h+"-"+f);if(e.next("span.property-group-state").attr("rel")=="off"){if(a==0){v.addClass("show")}var m=$("#property-template-"+f).clone().removeClass("template").removeClass("property-template-"+f).addClass("property"+o+" show").removeAttr("id");m.find("input.property-input, select.property-input").each(function(e){$(this).attr("name",$(this).attr("name").replace("selector_section",c).replace("selector_css",h))});m.find("div.tvr-mq-right").each(function(e){$(this).attr("id",$(this).attr("id").replace("selector_section",c).replace("selector_css",h))});if(n=="mq"){m.find("input.property-input, select.property-input").each(function(e){$(this).attr("name",$(this).attr("name").replace("tvr_mcth","tvr_mcth[non_section][m_query]["+i+"]"))}).end().find("span.important-toggle").each(function(){$(this).removeClass("imp-reg").addClass("imp-mq")})}v.find("div.property-fields").removeClass("show");v.find("span.mq-tab").removeClass("active");v.find("span.tab"+o).addClass("show active");v.append(m).show().find("input.device-focus").val(i);TvrUi.jscolor_bind(c,h,f,"single-group");e.next("span.property-group-state").attr("rel","on");if(f=="CSS3"){u.siblings("div.pie-switch").show()}if(a==0){u.prop("checked",true).next("span.property-group-state").attr("rel","on");TvrUi.update_count(d,"add",1,"style")}if(n=="reg"){$area.find("input.all-toggle").prop("checked",true).next("span.property-group-state").attr("rel","on")}TvrUi.update_mq_button($("#mq-button-"+i))}else if(e.next("span.property-group-state").attr("rel")=="on"){if(n=="reg"){$target=v.find("div.property-fields")}else{$target=v.find("div.property"+o)}$target.remove();var g=false;if(v.find("span.tab"+o).hasClass("active")){g=true}v.find("span.tab"+o).removeClass("show active");e.next("span.property-group-state").attr("rel","off");if(f=="CSS3"){u.siblings("div.pie-switch").hide()}if(a==2||n=="reg"){u.prop("checked",false).next("span.property-group-state").attr("rel","off");TvrUi.update_count(d,"subtract",1,"style");v.find("span.mq-tab").removeClass("show active");$area.find("input.style-config").prop("checked",false);$area.find("span.property-group-state").attr("rel","off");v.removeClass("show")}if(a>2&&g){v.find("span.mq-tab.show:eq(0)").addClass("active").end().find("div.property-fields:eq(0)").addClass("show");v.find("input.device-focus").val(v.find("span.mq-tab.active").attr("rel"))}if(TvrUi.visAutoSave){TvrUi.ajax_save_settings("save")}}},load_docs:function(e){if(e.hasClass("snippet")){var t=e.attr("href")}else if(e.hasClass("help-trigger")){var t=$("#show-tutorials").attr("rel")}if(e.hasClass("g-font")){TvrUi.gFontTarget=e.parents(".field-wrap").find(".property-input")}$.colorbox({href:t,innerHeight:"80%",innerWidth:"95%",fixed:true,iframe:true,open:true})},font_changed:function(e){if(TvrUi.visAutoSave){TvrUi.ajax_save_settings("save")}TvrUi.adjust_comp_span(e,"after")},bg_image_option:function(e,t){if(e.hasClass("bg-image-option")){var n=e.parent().parent().siblings().children("a.view-bg-images");var r=e.parent().parent()}else{var n=e.siblings().children("a.view-bg-images");var r=e}r.change(function(t){var r=e.val();var i=n.attr("title");if(r!=i){if(r==""){n.attr("alt",$("#first-bg-url").text()).attr("title","")}else{var s=n.attr("rel");s=s+=r;n.attr("alt",s).attr("title",r)}}})},view_bg_images:function(e,t){t.preventDefault();$("#bg-image-links a[rel='bg-image-ui']").colorbox({title:false,innerWidth:"60%",innerHeight:"70%",onComplete:function(){var e=$("#cboxLoadedContent");e.addClass("bg-img-squares");var t=e.find("img").attr("src");var n=t.replace(r,"");$("#cboxTitle").html('<a class="insert-bg" href="'+n+'"  rel="'+i+'" title="Click to Select">Select</a> | '+n+"")}});var n=e.attr("alt");var r=e.attr("rel");var i=e.parent().siblings("select").attr("name");$('#bg-image-links a[href="'+n+'"]').colorbox({open:true,rel:"bg-image-ui",returnFocus:false,title:false,innerWidth:500,onComplete:function(){var e=$("#cboxLoadedContent");e.addClass("bg-img-squares");var t=e.find("img").attr("src");var n=t.replace(r,"");$("#cboxTitle").html('<a class="insert-bg" href="'+n+'"  rel="'+i+'" title="Click to Select">Select</a> | '+n+"")}})},hand_css_reveal:function(e,t){t.preventDefault();$("#hand-css-area").toggle();if(e.text()=="Edit Hand-Coded CSS"){e.text("Cancel")}else{e.text("Edit Hand-Coded CSS")}},export_section_checkbox:function(e,t){if(e.attr("rel")=="off"){e.attr("rel","on");var n=$("#only-export-selected");if(n.attr("disabled")){n.removeAttr("disabled").attr("checked","checked")}}else if(e.attr("rel")=="on"){e.attr("rel","off");var r=false;$(".export-section:checked").each(function(){r=true;return false});if(!r){$("#only-export-selected").removeAttr("checked").attr("disabled","disabled")}}},important_toggle:function(e,t){if(e.attr("rel")=="off"){var n=e.next().attr("name");if(!e.hasClass("imp-mq")){var r=n.replace("tvr_mcth","tvr_mcth[non_section][important]").replace("[styles]","")}else{var r=n.replace("[non_section]","[non_section][important]").replace("[styles]","")}var i='<input class="important-tracker" type="hidden" name="'+r+'" value="1" />';e.attr("rel","on").addClass("tvr-toggle-on").before(i)}else if(e.attr("rel")=="on"){e.attr("rel","off").removeClass("tvr-toggle-on").prev(".important-tracker").remove()}if(TvrUi.visAutoSave){TvrUi.ajax_save_settings("save")}},get_section_meta:function(e,t){if(t=="this"){var n=e}else{var n=e.parents("div.section-wrap")}var r=new Array;r["secName"]=n.attr("id").replace("section-","");r["secObject"]=n;return r},get_selector_meta:function(e,t){if(t=="this"){var n=e}else{var n=e.parents("div.selector-wrap")}var r=n.attr("id");var i=r.split("-");var s=new Array;s["secName"]=i[1];s["selName"]=i[2];s["selObject"]=n;return s},custom_escape_quotes:function(e){var t=e.replace(/"/g,"cus-quot;").replace(/'/g,"cus-#039;");return t},custom_to_regular_escape:function(e){var t=e.replace(/cus-/g,"&");return t},custom_to_non_escaped:function(e){var t=e.replace(/cus-quot;/g,'"').replace(/cus-#039;/g,"'");return t},close_all_ui:function(){$("#tvr-ui div.hidden-options").hide();$("#tvr-ui a.edit-selectors").text("Edit Selectors");$("#tvr-ui a.edit-styles").text("Edit Styles");$('#view-states input[value="2"]').val(1)},sanitise_section:function(e){sanitisedSection=e.replace(/[^a-zA-Z0-9 ]+/g,"").replace("/ {2,}/"," ").toLowerCase();sanitisedSection=TvrCom.ucwords(sanitisedSection);return sanitisedSection},sanitise_selector_label:function(e){sanitisedLabel=e.replace(/[^a-zA-Z0-9 ]+/g,"").replace("/ {2,}/"," ").replace(/ /g,"_");sanitisedLabel=sanitisedLabel.toLowerCase();return sanitisedLabel},jscolor_bind:function(selectorSection,selectorID,propertyGroup,inputScope,$clicked){var matchClass=new RegExp("(^|\\s)("+mcthmr_jscolor.bindClass+")\\s*(\\{[^}]*\\})?","i");if(inputScope=="single"){var e=$clicked}else if(inputScope=="single-group"){var e=$("#group-"+selectorSection+"-"+selectorID+"-"+propertyGroup+" input.color")}else if(inputScope=="all-groups"){var e=$("#selector-"+selectorSection+"-"+selectorID+" input.color")}else if(inputScope=="all-selectors"){var e=$("#section-"+selectorSection+" input.color")}for(var i=0;i<e.length;i+=1){var m;if((!e[i].color||e[i].color=="ffffff")&&e[i].className&&(m=e[i].className.match(matchClass))){var prop={};if(m[3]){try{eval("prop="+m[3])}catch(eInvalidProp){}}e[i].color=new mcthmr_jscolor.color(e[i],prop)}}},update_count:function(e,t,n,r,i){var s=$("#tvr-ui");var o=parseInt(e.attr("rel"));if(t=="add"){var u=o+n}else if(t=="subtract"){var u=o-n}if(o==0){e.prev("a").after(' <span class="count-wrap">(<span class="state-count"></span>)</span>');var a=true}if(u==0){e.prev("span").remove();var f=true}e.attr("rel",u);e.prev("span").children("span").text(u);if(r=="section"){if(o==2&&u==1){var l=$("a#sections-sortable-button");l.fadeOut("fast",function(){l.remove()})}if(o==1&&u==2){$("span.section-count-state",s).after('<a href="#" id="sections-sortable-button" class="sections-sortable prominent-action">Enable Sortable Sections</a>');$("a#sections-sortable-button").hide().fadeIn("fast")}var c=$("#total-sec-count");if(u>o){window.TvrSharedVars.totalSecs=parseInt(c.text())+n;c.text(window.TvrSharedVars.totalSecs)}else{window.TvrSharedVars.totalSecs=parseInt(c.text())-n;c.text(window.TvrSharedVars.totalSecs);TvrUi.totalSels=TvrUi.totalSels-i;$("#total-sel-count").text(TvrUi.totalSels)}}else if(r=="selector"){var h=TvrUi.get_section_meta(e);var p=h["secName"];var d=$("#vmenu-"+p);if(a){var v=d.text();d.text(v+" ("+u+")")}else if(f){var v=d.text().replace(/(.+) \(\d+\)$/,"$1");d.text(v)}else{var v=d.text().replace(/(.+) \(\d+\)$/,"$1 ("+u+")");d.text(v)}if(o==2&&u==1){var l=$("#"+p+"-selectors a.selectors-sortable",s);l.fadeOut("slow",function(){l.remove()})}if(o==1&&u==2){$("#"+p+"-selectors div.selector-fields").after('<a href="#" rel="'+p+'" class="selectors-sortable prominent-action">Enable Sortable Selectors</a>');$("#"+p+"-selectors a.selectors-sortable").hide().fadeIn("slow")}var m=$("#total-sel-count");if(u>o){TvrUi.totalSels=parseInt(m.text())+n;m.text(TvrUi.totalSels)}else{TvrUi.totalSels=parseInt(m.text())-n;m.text(TvrUi.totalSels)}}else if(r=="style"){var h=TvrUi.get_selector_meta(e);$("#vmenu-display-"+h["secName"]+"-"+h["selName"]+", #vmenu-"+h["secName"]+"-"+h["selName"]).each(function(){if(a){var e=$(this).text();$(this).text(e+" ("+u+")")}else if(f){var e=$(this).text().replace(/(.+) \(\d+\)$/,"$1");$(this).text(e)}else{var e=$(this).text().replace(/(.+) \(\d+\)$/,"$1 ("+u+")");$(this).text(e)}})}if(window.TvrSharedVars.context=="visual"){TvrUi.toggle_enabled_buttons()}},update_view_state_tracker:function(e,t,n,r,i){if(t=="section"){var s=e.parent().parent().parent().attr("id").replace("section-","");var o=$("#view-state-"+s+"-this");var u=o.val();if(o.val()==0){TvrUi.ajax_load_ui_data(e,s,"",o,t,n,r,i)}else if(u==1){o.val(2);TvrUi.edit_selectors(e);if(window.TvrSharedVars.context=="visual"&&TvrUi.visualStylesEnabled){TvrUi.enable_visual_style_options_2()}}else if(u==2){o.val(1);TvrUi.edit_selectors(e)}}if(t=="selector"){var a=e.parent().parent().parent().attr("id").replace("selector-","").split("-");var s=a[0];var f=a[1];var l=$("#view-state-"+s+"-"+f);if(l.val()==0){TvrUi.ajax_load_ui_data(e,s,f,l,t,n,r,i)}else if(l.val()==1){l.val(2);TvrUi.edit_styles(e)}else if(l.val()==2){l.val(1);TvrUi.edit_styles(e)}}},ajax_load_ui_data:function(e,t,n,r,i,s,o,u){var a=$("#ui-nonce").text();var f="admin.php?page=tvr-microthemer.php";var l="action=tvr_microthemer_ui_load_styles&tvr_load_section="+t;l+="&tvr_load_type="+i;l+="&_wpnonce="+a;if(i=="section"){var c=$("#section-"+t);var h="all-selectors";var p="Edit Selectors";if(s==1){l+="&tvr_force_selectors=1"}if(window.TvrSharedVars.context=="visual"){var d=$("#section-data-loading");d.show()}}if(i=="selector"){var c=$("#selector-"+t+"-"+n);var h="all-groups";var p="Edit Styles";l+="&tvr_load_selector="+n}var v=c.find("div.manage-x");if(s==3){v=$("#section-"+t).find("div.manage-x").first();if(TvrUi.selsToLoad==TvrUi.totalToLoad){v.removeClass("styles-failed").addClass("styles-loading");TvrUi.update_prog_indicator("plus","Loading Style Options...")}}else{v.removeClass("styles-failed").addClass("styles-loading");TvrUi.update_prog_indicator("plus","Loading Style Options...")}$.ajax({type:"GET",url:f,async:true,data:l,timeout:2e4,error:function(e,t){v.addClass("styles-failed");if(window.TvrSharedVars.context=="visual"){alert("Selector editing options could not be loaded")}},success:function(a){var f=$(a);var l=f.find("#tmp-wrap").html();c.find("div.hidden-options").append(l);TvrUi.jscolor_bind(t,n,"",h);if(i=="section"){if(s==1){$("li#strk-"+t+' input[value="0"]').val(1);TvrUi.reveal_rename_section(o)}else if(s==2){r.val(s);TvrUi.edit_selectors(e);if(window.TvrSharedVars.context=="visual"){TvrUi.enable_visual_style_options_2()}}}else if(i=="selector"){if(s==1){TvrUi.reveal_modify_selector(o);r.val(1)}else if(s==2){TvrUi.edit_styles(e);r.val(2)}else if(s==3){--TvrUi.selsToLoad;if(TvrUi.selsToLoad==0){v.removeClass("styles-loading");TvrUi.update_prog_indicator("minus");TvrUi.reveal_rename_section(o)}r.val(1)}}if(u=="default_to_first_sel, load selectors visibly"){TvrUi.update_prog_indicator("minus");if(TvrUi.visualStylesEnabled){TvrUi.enable_visual_style_options()}}if(u=="enable_visual_style_options, load selectors visibly"){TvrUi.update_prog_indicator("minus");TvrUi.enable_visual_style_options_2()}if(u=="display_visual_add_sec_sel, load selectors visibly"){TvrUi.update_prog_indicator("minus");var p=$("#"+TvrUi.secInFocus+"-selectors").find("div.add-sel-wrap");var d=p.find("a.reveal-add-selector");TvrUi.display_visual_add_sec_sel_2(p,d,"Selector",TvrUi.intelliAfterLoad);TvrUi.intelliAfterLoad=false}if(u=="display_visual_sort, load selectors visibly"){TvrUi.update_prog_indicator("minus");var m=$("#"+TvrUi.secInFocus+"-selectors");var g=m.find("div.selector-fields");var y=m.find("a.selectors-sortable");TvrUi.display_visual_sort_2(g,y,u)}TvrUi.dataLoading=false},complete:function(){if(s!=3){v.removeClass("styles-loading");TvrUi.update_prog_indicator("minus")}if(window.TvrSharedVars.context=="visual"&&i=="section"){var e=$("#section-data-loading");e.hide()}}})},ajax_load_revisions_table:function(e){if(e.hasClass("already-loaded")){return false}if(window.TvrSharedVars.context=="visual"){TvrUi.update_prog_indicator("plus","Loading Revisions Table...")}var t=e.attr("rel");e.addClass("revisions-loading");$.ajax({type:"GET",url:t,async:true,timeout:2e4,error:function(t,n){e.removeClass("revisions-loading").addClass("revisions-failed")},success:function(t){var n=$(t).find("#tmp-wrap").html();e.removeClass("revisions-loading").addClass("already-loaded");$("#revision-area").html(n).slideDown();if(window.TvrSharedVars.context=="visual"){TvrUi.update_prog_indicator("minus")}}})},remove_revisions_table:function(){if($("#revisions-table").length){$("#revision-area").slideUp().find("#revisions-table").remove();$("#reveal-revisions").removeClass("already-loaded")}},export_checkbox:function(e,t,n){$("div.export-option",t).slideToggle("fast")},previewcss:function(e,t,n){n.preventDefault();if($("#save-ui-first").is(":checked")){TvrUi.ajax_save_settings("preview-css")}else{TvrUi.preview_css()}},speed_up_ui:function(e,t){TvrUi.speedUp=true;TvrUi.close_all_ui();TvrUi.ajax_save_settings("save")},close_all_ui_link:function(e,t){TvrUi.close_all_ui()},ui_reset:function(e,t,n){var r=confirm("Are you sure you want to reset all settings? You will perminantly lose any settings you have not exported to a Micro Theme.");if(!r){n.preventDefault()}},clear_styles:function(e,t,n){var r=confirm("Are you sure you want to clear all styles? Note: The page will reload, so please save any unsaved sections/selectors first. Also, the hand-coded CSS area won't get cleared. Please do that manually if required.");if(!r){n.preventDefault()}},restore_rev:function(e,t){var n=confirm("Are you sure you want to restore previous settings?");if(!n){t.preventDefault()}},ui_import:function(e,t,n){if($("#microthemer_ui_settings_import select").val()==""){alert("Please select a theme from the list");n.preventDefault()}else if(!$("#ui-import-overwrite").is(":checked")&&!$("#ui-import-merge").is(":checked")){alert("Please choose an import method (overwrite or merge)");n.preventDefault()}else{if($("#ui-import-overwrite").is(":checked")){var r="This will OVERWRITE"}else{var r="They will be MERGED with"}var i=confirm("Are you sure you want to import these settings? "+r+" your current settings.");if(!i){n.preventDefault()}}},preview_css:function(){var e=$("#previewcss").attr("href");e+="?nocache="+(new Date).getTime();$.colorbox({href:e,innerHeight:"78%",innerWidth:"78%",iframe:true,open:true})},ajax_save_settings:function(e){var t=$("#fixed-menu");if(t.find("input.export-checkbox").is(":checked")&&!t.find("select.export-select").val()){alert("Please select an existing settings pack to export to or choose 'New' from the dropdown menu.");return false}if(TvrUi.saveInProgress){TvrUi.reSave=true;return false}TvrUi.saveInProgress=true;var n=$("#fixed-menu input.ui-save").attr("rel");var r=$("#ajax-message");var i=$("#loading-gif");if(window.TvrSharedVars.context=="visual"){TvrUi.update_prog_indicator("plus","Saving Settings...")}else{i.show("fast")}r.hide();var s=$("#tvr_microthemer_ui_save, #tvr_microthemer_ui_save2").serialize();TvrUi.lastPostedDataString=s;$.ajax({type:"POST",url:n,data:s,timeout:2e4,error:function(e,t){TvrUi.saveInProgress=false;TvrUi.reSave=false;TvrUi.handle_ajax_error(e,t)},success:function(t){if(TvrUi.reSave){TvrUi.reSave=false;TvrUi.ajax_save_settings("save")}if(TvrUi.speedUp){location.reload()}TvrUi.remove_revisions_table();if(window.TvrSharedVars.context=="visual"){TvrUi.update_prog_indicator("minus");TvrUi.update_prog_indicator("plus","Reloading Styles...");window.frames["viframe"].TvrExportVars.refreshCSS()}else{i.hide()}var n=$(t);var s=n.find("#microthemer-notice").html();if(s==null){var o=true;s="<p><b>Save Error:</b><br />Please ";s+='<a id="email-error" href="#" title="FYI, you will send Microthemer settings, browser and email and info">Email Error Report</a> to Themeover</p>';s+="<p>Reloading the page is normally a quick fix.<br /><b>Note:</b> unsaved changes may need to be re-done.</p>";s+='<form id="error-report-form" name="error_report" method="post">';s+='<textarea name="tvr_php_error">'+t+"</textarea>";s+='<textarea name="tvr_serialised_data">'+TvrUi.lastPostedDataString+"</textarea>";var u="";jQuery.each(jQuery.browser,function(e,t){u+=e+" : "+t+"\n"});s+='<textarea name="tvr_browser_info">'+u+"</textarea>";s+="</form>"}var a=n.find("#sanit-export-name").text().split("|");var t="";var f="";r.html(s+'<p><a href="#" id="hide-notification">Hide Message</a></p>').show();if(e=="preview"){e=null;TvrUi.preview_frontend("view","")}if(e=="preview-css"){e=null;TvrUi.preview_css()}if(a[0]=="yes"){var l='<option value="'+a[1]+'" selected="selected">'+TvrCom.ucwords(a[2])+"</option>";$("#fixed-menu select.export-select").append(l);$("#fixed-menu select.import-select").append(l.replace('selected="selected"',""));$("#export-new-name").hide("fast");$("#export-new-name input").val("")}if(window.TvrSharedVars.context=="visual"&&o){alert("Save Error: please see the message in the default view.")}TvrUi.saveInProgress=false}})},handle_ajax_error:function(e,t){if(e.status==0){$("#ajax-message, #loading-gif").hide();alert("Connection Error. Save Request Failed. Please Try again.")}else if(e.status==404){$("#ajax-message, #loading-gif").hide();alert("Requested URL not found.")}else if(e.status==500){$("#ajax-message, #loading-gif").hide();alert("Internel Server Error.")}else if(t=="parsererror"){$("#ajax-message, #loading-gif").hide();alert("Error.\nParsing JSON Request failed.")}else if(t=="timeout"){$("#ajax-message, #loading-gif").hide();alert("Request Timed out.")}else{$("#ajax-message, #loading-gif").hide();alert("Unknow Error.\n"+e.responseText)}},email_error_report:function(e,t,n){var r=$("#ui-nonce").text();var i=$("#fixed-menu input.ui-save").attr("rel");i+="&action=tvr_error_email&_wpnonce="+r;var s=$("#ajax-message");var o=$("#loading-gif");o.show("fast");s.hide();var u=$("#error-report-form").serialize();$.ajax({type:"POST",url:i,data:u,timeout:2e4,error:function(e,t){TvrUi.handle_ajax_error(e,t)},success:function(e){o.hide();var t=$(e);var n=t.find("#microthemer-notice").html();if(n==null){n="<p><b>Mail Script Error</b></p>"}s.html(n+'<p><a href="#" id="hide-notification">Hide Message</a></p>').show()}})},update_prog_indicator:function(e,t){if(window.TvrSharedVars.progCount<0){window.TvrSharedVars.progCount=0;return false}var n=$("#progress-indicator");var r=$("#status-board");if(e=="plus"){var i=r.find('p[rel="'+t+'"]');if(i.length){return false}++window.TvrSharedVars.progCount;n.attr("title",t);if(window.TvrSharedVars.progCount==1){n.addClass("active");r.html("")}r.append('<p id="prog-'+window.TvrSharedVars.progCount+'" rel="'+t+'">'+t+"</p>")}else{--window.TvrSharedVars.progCount;if(window.TvrSharedVars.progCount<=0){r.html('<p><b>Need Help?</b> <a class="help-trigger" id="vis-help-video" href="#">View Videos</a></p><p><b>Tip:</b> Press Ctrl+S to Save</p>');n.removeClass("active").attr("title","Nothing in Progress")}else{$("#prog-"+window.TvrSharedVars.progCount).addClass("status-complete")}}},default_to_first_sel:function(){$("#view-states").find("input.selector-tracker").each(function(){var e=$(this);TvrUi.curSelTrackerID=e.attr("id");window.TvrSharedVars.curSelCSS=e.attr("title");TvrUi.selInFocusID=TvrUi.curSelTrackerID.replace("view-state","selector");var t=e.siblings("input.section-tracker").val();if(t!=2){if(t=="0"){TvrUi.update_prog_indicator("plus","Loading Section Selectors...");TvrUi.dataLoading=true}TvrUi.update_view_state_tracker(TvrUi.get_edit_sels_link(),"section",2,"","default_to_first_sel, load selectors visibly")}return false})},get_edit_sels_link:function(){var e=TvrUi.selInFocusID.split("-");var t=e[1];return $("#section-"+t).find("a.edit-selectors")},set_initial_visual_controls:function(){TvrUi.visualTriggerSel=TvrUi.selInFocusID;var e=TvrUi.selInFocusID.split("-");var t=e[1];var n=e[2];TvrUi.update_section_vmenu(t);TvrUi.update_selector_vmenu("vmenu-"+t+"-"+n,true);TvrUi.prevNext=TvrUi.update_visual_controls($("#"+TvrUi.curSelTrackerID));TvrUi.curSelTrackerID=""},hide_other_visual:function(e,t){if(e!="selector"&&TvrUi.visAddSelEnabled){TvrUi.hide_visual_add_sec_sel("Selector",t)}if(e!="section"&&TvrUi.visAddSecEnabled){TvrUi.hide_visual_add_sec_sel("Section",t)}if(e!="sort_section"&&TvrUi.visSecSortable){TvrUi.hide_visual_sort("Section",t)}if(e!="sort_selector"&&TvrUi.visSelSortable){TvrUi.hide_visual_sort("Selector",t)}if(e!="css"&&TvrUi.visRawCSS){TvrUi.hide_vis_raw_css()}if(e!="revisions"&&TvrUi.visRevisions){TvrUi.hide_vis_revisions()}},toggle_visual_sort:function(e){if(e=="Section"){if(TvrUi.visSecSortable){TvrUi.hide_visual_sort(e,true)}else{TvrUi.display_visual_sort(e)}}else{if(TvrUi.visSelSortable){TvrUi.hide_visual_sort(e,true)}else{TvrUi.display_visual_sort(e)}}},display_visual_sort:function(e){if(e=="Section"){$("#toggle-sortable-sections").addClass("on");TvrUi.hide_other_visual("sort_section",true);var t=$("#section-fields");var n=$("#sections-sortable-button")}else{$("#toggle-sortable-selectors").addClass("on");TvrUi.hide_other_visual("sort_selector",true);var r=$("#view-state-"+TvrUi.secInFocus+"-this").val();if(r=="0"){TvrUi.update_prog_indicator("plus","Loading Section Selectors");TvrUi.dataLoading=true}if(r!="2"){var i=$("#section-"+TvrUi.secInFocus).find("a.edit-selectors");TvrUi.update_view_state_tracker(i,"section",2,"","display_visual_sort, load selectors visibly");if(TvrUi.dataLoading){return false}}var s=$("#"+TvrUi.secInFocus+"-selectors");var t=s.find("div.selector-fields");var n=s.find("a.selectors-sortable")}if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options("fully");TvrUi.visualStylesDisabledBySort=true}TvrUi.display_visual_sort_2(t,n,e)},display_visual_sort_2:function(e,t,n){if(n=="Section"){TvrUi.sections_sortable(t);TvrUi.visSecSortable=true}else{TvrUi.selectors_sortable(t);TvrUi.visSelSortable=true}$("#toggle-editing").addClass("disabled");e.addClass("tvr-visual").css("height",TvrUi.frameHeight-65+"px").slideDown("fast")},hide_visual_sort:function(e,t){if(e=="Section"){var n=$("#section-fields");if(window.TvrSharedVars.totalSecs>1){TvrUi.sections_sortable($("#sections-sortable-button"))}TvrUi.visSecSortable=false;$("#toggle-sortable-sections").removeClass("on")}else{if(!t){var r=$("#"+TvrUi.prevSecInFocus+"-selectors")}else{var r=$("#"+TvrUi.secInFocus+"-selectors")}var n=r.find("div.selector-fields");TvrUi.selectors_sortable(r.find("a.selectors-sortable"));TvrUi.visSelSortable=false;$("#toggle-sortable-selectors").removeClass("on")}n.slideUp("fast",function(){n.removeClass("tvr-visual").css("height","auto").show();TvrUi.toggle_enabled_buttons()});if(TvrUi.visualStylesDisabledBySort&&window.TvrSharedVars.context=="visual"){if(TvrUi.totalSels>0){TvrUi.enable_visual_style_options()}TvrUi.visualStylesDisabledBySort=false}},toggle_raw_css:function(){if(TvrUi.visRawCSS){TvrUi.hide_vis_raw_css()}else{TvrUi.display_vis_raw_css()}},display_vis_raw_css:function(){TvrUi.hide_other_visual("css",true);var e=TvrUi.frameHeight-45;$("#hand-css-area").addClass("tvr-visual").css("height",e+"px").slideDown("fast").find("textarea").css("height",e-35+"px");TvrUi.visRawCSS=true},hide_vis_raw_css:function(){$("#hand-css-area").slideUp("fast",function(){$(this).removeClass("tvr-visual").css("height","auto").find("textarea").css("height","500px")});TvrUi.visRawCSS=false},adjust_comp_span:function(e,t){if(t=="after"){if(!e.val()){e.parent().removeClass("manual-val");e.siblings("span.comp-style").removeClass("hidden")}else{e.parent().addClass("manual-val");e.siblings("span.comp-style").addClass("hidden")}}else if(t=="hover"){e.siblings("span.comp-style").addClass("hidden")}},toggle_auto_save:function(){if(TvrUi.visAutoSave){TvrUi.disable_auto_save()}else{TvrUi.enable_auto_save()}},enable_auto_save:function(){$("#toggle-auto-save").addClass("on");TvrUi.visAutoSave=true},done_typing:function(){TvrUi.ajax_save_settings("save")},disable_auto_save:function(){$("#toggle-auto-save").removeClass("on");TvrUi.visAutoSave=false},toggle_revisions:function(){if(TvrUi.visRevisions){TvrUi.hide_vis_revisions()}else{TvrUi.display_vis_revisions()}},toggle_fixed_menu:function(){if(TvrUi.fixedMenu){TvrUi.hide_fixed_menu()}else{TvrUi.display_fixed_menu()}},display_fixed_menu:function(){$("#fixed-menu-inner").find(".fixed-subsection").show();var e=$("#fixed-menu-inner");var t=e.height();$("#fixed-menu").animate({width:"147px",height:"auto"},300,function(){e.css("border","1px solid #DFDFDF");$("#toggle-fixed-menu").removeClass("hid")}).removeClass("side-hid");TvrUi.fixedMenu=true},hide_fixed_menu:function(){var e=$("#fixed-menu-inner");var t=e.height();$("#fixed-menu").animate({width:"0px",height:t+"px"},300,function(){e.css("border",0);$("#fixed-menu-inner").find(".fixed-subsection").add("#ajax-message").hide();$("#toggle-fixed-menu").addClass("hid")}).addClass("side-hid");TvrUi.fixedMenu=false},display_vis_revisions:function(){TvrUi.hide_other_visual("revisions",true);var e=TvrUi.frameHeight-45+"px";$("#revision-area").addClass("tvr-visual").css("height",e).slideDown("fast",function(){TvrUi.ajax_load_revisions_table($("#reveal-revisions"))});TvrUi.visRevisions=true},hide_vis_revisions:function(){$("#revision-area").slideUp("fast",function(){$(this).removeClass("tvr-visual").css("height","auto")});TvrUi.visRevisions=false},display_visual_add_sec_sel:function(e,t){if(e=="Section"){if(!TvrUi.allowed_action("","Add Sec")){return false}TvrUi.hide_other_visual("section",true);$("#vb-add-section").addClass("disabled");var n=$("#add-new-section");var r=n.find("a.reveal-add-section")}else{var i=$("#section-"+TvrUi.secInFocus).find("a.edit-selectors");if(!TvrUi.allowed_action(i,"Add Sel")){return false}TvrUi.hide_other_visual("selector",true);$("#vb-add-selector").addClass("disabled");if($("#view-state-"+TvrUi.secInFocus+"-this").val()=="0"){TvrUi.update_prog_indicator("plus","Loading Selector Controls");TvrUi.dataLoading=true;if(t){TvrUi.intelliAfterLoad=true}else{TvrUi.intelliAfterLoad=false}}if(i.text()=="Edit Selectors"){TvrUi.update_view_state_tracker(i,"section",2,"","display_visual_add_sec_sel, load selectors visibly");if(TvrUi.dataLoading){return false}}var n=$("#"+TvrUi.secInFocus+"-selectors").find("div.add-sel-wrap");var r=n.find("a.reveal-add-selector")}TvrUi.display_visual_add_sec_sel_2(n,r,e,t)},display_visual_add_sec_sel_2:function(e,t,n,r){if(t.text()=="Add New "+n){if(n=="Section"){TvrUi.toggle_add_section(t)}else{TvrUi.toggle_add_selector(t)}}var i="tvr-visual";if(n=="Section"){TvrUi.visAddSecEnabled=true}else{if(r){i+=" tvr-intelli";var s=$("#intelli-wrap-template").clone().removeClass("template").attr("id","intelli-wrap").bind("click",function(e){var t=$(e.target);var n=t.prop("tagName").toLowerCase();var r=t.attr("class");if(r&&r.indexOf("tvr-active")>=0){var i=window.TvrSharedVars.TvrSugCSS;if(r.indexOf("tvr-parent")>=0){var s=i["Intelli"]["parent"]}else if(r.indexOf("tvr-child")>=0){var s=i["Intelli"]["child"]}else if(r.indexOf("tvr-prev-sibling")>=0){var s=i["Intelli"]["prev"]}else if(r.indexOf("tvr-next-sibling")>=0){var s=i["Intelli"]["next"]}window.frames["viframe"].TvrExportVars.build_selector_suggestions(s)}});s.find("select").attr("id","intelli-menu").bind("change",function(e){window.TvrSharedVars.intelli_css=$(this).val();window.frames["viframe"].TvrExportVars.switch_highlight("intelli");$("#"+TvrUi.secInFocus+"-selectors").find("textarea.selector-css").val($(this).val())});e.find("div.new-css-selectors").prepend(s);TvrUi.update_selector_wizard();window.TvrSharedVars.intelli=true;if(TvrUi.transWizard){e.addClass("tvr-transparent").bind({mouseenter:function(){$(this).removeClass("tvr-transparent")},mouseleave:function(){$(this).addClass("tvr-transparent")}})}}TvrUi.visAddSelEnabled=true}$("#toggle-highlighting").removeClass("disabled");e.addClass(i).slideDown("fast")},update_selector_wizard:function(){var e=$("#intelli-wrap");var t=window.TvrSharedVars.TvrSugCSS;var n="";var r=0;for(var i in t){if(i=="Intelli"){break}++r;if(r==t["Intelli"]["ogCount"]){var s=" (highest specificity)"}else{var s=""}n+='<optgroup label="'+i+s+'">';for(key2 in t[i]){if(window.TvrSharedVars.intelli_css==key2){var o='selected="selected"'}else{var o=""}n+='<option value="'+key2+'" '+o+" title='"+t[i][key2]+"'>"+key2+"</option>"}n+="</optgroup>"}e.find("select").html(n);e.find("div.refine-target-controls span").removeClass("tvr-active");e.find("div.refine-target-controls span").each(function(e){var n=$(this);var r=n.attr("class");if(r.indexOf("tvr-parent")>=0&&t["Intelli"]["parent"]){n.addClass("tvr-active")}else if(r.indexOf("tvr-child")>=0&&t["Intelli"]["child"]){n.addClass("tvr-active")}else if(r.indexOf("tvr-prev-sibling")>=0&&t["Intelli"]["prev"]){n.addClass("tvr-active")}else if(r.indexOf("tvr-next-sibling")>=0&&t["Intelli"]["next"]){n.addClass("tvr-active")}});e.find("div.refine-target-html span").html(t["Intelli"]["htmlString"]);$("#"+TvrUi.secInFocus+"-selectors").find("textarea.selector-css").val(window.TvrSharedVars.intelli_css)},hide_visual_add_sec_sel:function(e,t){if(window.TvrSharedVars.intelli){$("#intelli-wrap").remove();TvrUi.return_normal_highlighting()}if(e=="Section"){var n=$("#add-new-section");$("#vb-add-section").removeClass("disabled");TvrUi.visAddSecEnabled=false}else{if(!t){var r=TvrUi.prevSecInFocus}else{var r=TvrUi.secInFocus}var n=$("#"+r+"-selectors").find("div.add-sel-wrap");$("#vb-add-selector").removeClass("disabled");TvrUi.visAddSelEnabled=false}n.slideUp("fast",function(){if(window.TvrSharedVars.intelli){if(TvrUi.transWizard){n.unbind("mouseenter mouseleave").removeClass("tvr-transparent")}window.TvrSharedVars.intelli=false}n.removeClass("tvr-visual").show()})},load_visual_view:function(e){if(window.TvrSharedVars.context=="visual"){return false}var t=$("body");t.addClass("tvr-visual");TvrUi.frameHeight=t.height()-146;var n=57+67+49+49+57+57+57+57;n=n+12+12;n=n+173+173;var r=TvrUi.frameWidth-n;$("#vmenu-sections").css("maxWidth",173+Math.floor(r*.4)+"px");$("#vmenu-selectors-display").css("maxWidth",173+Math.floor(r*.6)+"px");window.TvrSharedVars.context="visual";TvrUi.visualLastEditedSel="";TvrUi.visualStylesEnabled=true;if(TvrUi.visAutoSaveDefault){TvrUi.enable_auto_save()}TvrUi.toggle_enabled_buttons();if(e.attr("id")=="load-visual"){TvrUi.default_to_first_sel()}else{window.TvrSharedVars.curSelCSS=e.attr("title");TvrUi.selInFocusID=e.parent(".selector-wrap").attr("id");TvrUi.curSelTrackerID=TvrUi.selInFocusID.replace("selector","view-state")}if(TvrUi.totalSels>0){TvrUi.set_initial_visual_controls()}else{if(window.TvrSharedVars.totalSecs>0){TvrUi.secInFocus=$("#view-states").find("input.section-tracker:eq(0)").attr("id").replace("view-state-","").replace("-this","");TvrUi.update_selector_vmenu("vmenu-"+TvrUi.secInFocus+"-this",true)}}if(TvrUi.placeholderFrame){TvrUi.update_prog_indicator("plus","Loading WordPress Site...");$("#viframe").contents().find("body").css("height",TvrUi.frameHeight+"px");window.frames["viframe"].location=$("#viframe").attr("rel");TvrUi.placeholderFrame=false}$("#v-frontend").css("height",TvrUi.frameHeight);$("#wpadminbar, #adminmenuwrap").hide();$("#visual-view").show(function(){if(window.TvrSharedVars.totalSecs<1){TvrUi.display_visual_add_sec_sel("Section")}});$("#fixed-menu").addClass("tvr-visual");if($("#ajax-message").html()==""){TvrUi.hide_fixed_menu()}TvrUi.frameWidth=$("body").width();if(!TvrUi.iframe_slider_set){TvrUi.update_iframe_slider(0,0)}},toggle_enabled_buttons:function(){var e=$("#vb-add-selector");var t=$("#vb-focus-prev, #vb-focus-next, #toggle-editing, #toggle-highlighting, #toggle-sortable-selectors");if(window.TvrSharedVars.totalSecs<1){e.addClass("disabled")}if(TvrUi.totalSels<1){t.addClass("disabled")}var n=false;var r=parseInt($("#section-"+TvrUi.secInFocus).find("span.selector-count-state").attr("rel"));if(TvrCom.hasValue(TvrUi.secInFocus)&&r<1){$("#toggle-editing, #toggle-highlighting").addClass("disabled");n=true}if(window.TvrSharedVars.totalSecs>0){e.removeClass("disabled")}if(TvrUi.totalSels>0&&!n){t.removeClass("disabled")}if(TvrUi.visSecSortable||TvrUi.visSelSortable){$("#toggle-editing").addClass("disabled")}},remember_page_viewed:function(){var e=$("#previewurl").val();var t=$("#ajaxUrl").val();var n=$("#site-url").attr("rel");var r=$("#viframe").contents().find("#iframe-url").attr("content");if(r&&r.indexOf(n)===0&&r!=e&&r!=""&&!TvrUi.placeholderFrame){$.get(t+"&tvr_microthemer_ui_preview_url="+r,function(){$("#previewStatus").text("iframe-success")});$("#previewurl").val(r)}},close_visual_view:function(){window.TvrSharedVars.context="default";if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options("fully")}TvrUi.hide_other_visual("",true);if(TvrUi.visAutoSave){TvrUi.disable_auto_save()}$("#add-new-section").removeClass("disabled");$("#wpadminbar, #adminmenuwrap").show();$("body").removeClass("tvr-visual");if(!TvrUi.fixedMenu){TvrUi.display_fixed_menu()}$("#fixed-menu").removeClass("tvr-visual");$("#visual-view").hide();if(TvrUi.totalSels>0&&TvrCom.hasValue(TvrUi.visualLastEditedSel)&&TvrCom.hasValue(TvrUi.visualTriggerSel)&&TvrUi.visualLastEditedSel!=TvrUi.visualTriggerSel&&$("#scroll-pref").attr("rel")==1){$("html, body").animate({scrollTop:$("#"+TvrUi.visualLastEditedSel).offset().top-36},250)}else{$("html, body").animate({scrollTop:$("#"+TvrUi.visualTriggerSel).offset().top-36},250)}},update_visual_controls:function(e){var t=new Array;t[0]=e.prev();t[1]=e.next();if(t[0].hasClass("section-tracker")){t[0]=t[0].prev()}if(TvrUi.visualStylesEnabled&&!TvrUi.dataLoading&&!TvrUi.visSelSortable&&!e.hasClass("section-tracker")){TvrUi.enable_visual_style_options()}if(!TvrCom.hasValue(t[0].attr("id"))){var n=e.parent("li.strk").prev("li.strk");var r=TvrUi.selectorTrackerScan(n,"prev");if(r&&TvrCom.hasValue(r.attr("id"))){t[0]=r;$("#vb-focus-prev").removeClass("disabled");var i=r.attr("id").split("-");t["prev-section"]=i[2]}else{$("#vb-focus-prev").addClass("disabled");t["prev-section"]=false}}else{$("#vb-focus-prev").removeClass("disabled");t["prev-section"]=false}if(!TvrCom.hasValue(t[1].attr("id"))){var s=e.parent("li.strk").next("li.strk");var o=TvrUi.selectorTrackerScan(s,"next");if(o&&TvrCom.hasValue(o.attr("id"))){t[1]=o;$("#vb-focus-next").removeClass("disabled");var i=o.attr("id").split("-");t["next-section"]=i[2]}else{$("#vb-focus-next").addClass("disabled");t["next-section"]=false}}else{$("#vb-focus-next").removeClass("disabled");t["next-section"]=false}TvrUi.refresh_comp_css();return t},selectorTrackerScan:function(e,t){if(t=="prev"){var n=e;if(TvrCom.hasValue(n.attr("id"))){var r=n.find("input.view-state-input").last();if(TvrCom.hasValue(r.attr("id"))&&!r.hasClass("section-tracker")){return r}else{return TvrUi.selectorTrackerScan(n.prev("li.strk"),t)}}else{return false}}else if(t=="next"){var i=e;if(TvrCom.hasValue(i.attr("id"))){var s=i.find("input.view-state-input").first().next();if(TvrCom.hasValue(s.attr("id"))){return s}else{return TvrUi.selectorTrackerScan(i.next("li.strk"),t)}}else{return false}}},get_set_iframe:function(){var e=$("#cboxLoadedContent iframe").attr("name");$("#cboxLoadedContent iframe").attr("id",e);return e},toggle_highlighting:function(){if(window.TvrSharedVars.highlightEnabled){window.TvrSharedVars.highlightEnabled=false;$("#toggle-highlighting").removeClass("on");window.frames["viframe"].TvrExportVars.hideOverlays()}else{window.TvrSharedVars.highlightEnabled=true;$("#toggle-highlighting").addClass("on");window.frames["viframe"].TvrExportVars.showOverlays()}},return_normal_highlighting:function(){if(window.TvrSharedVars.highlightEnabled&&window.TvrSharedVars.tmpHighlighting){window.TvrSharedVars.tmpHighlighting=false;TvrUi.toggle_highlighting()}window.frames["viframe"].TvrExportVars.switch_highlight("reg")},enable_visual_style_options:function(){if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options(false)}TvrUi.visualLastEditedSel=TvrUi.selInFocusID;var e=$("#"+TvrUi.selInFocusID.replace("selector","view-state"));var t=e.siblings("input.section-tracker").val();if(t!=2){if(t=="0"){TvrUi.update_prog_indicator("plus","Loading Section Selectors...");TvrUi.dataLoading=true}TvrUi.update_view_state_tracker(TvrUi.get_edit_sels_link(),"section",2,"","enable_visual_style_options, load selectors visibly");if(TvrUi.dataLoading){return false}}TvrUi.enable_visual_style_options_2()},enable_visual_style_options_2:function(){var e=$("#"+TvrUi.selInFocusID);e.addClass("selector-wrap-overlay");if(TvrUi.transEditing){e.bind({mouseenter:function(){$(this).find("div.hidden-options").removeClass("tvr-transparent")},mouseleave:function(){if(!TvrJscolor.showing){$(this).find("div.hidden-options").addClass("tvr-transparent")}}})}var t=e.find("div.hidden-options");t.css("height",TvrUi.frameHeight-45+"px");if(TvrUi.transEditing){t.addClass("tvr-transparent")}$("#toggle-editing").addClass("on");TvrUi.visualStylesEnabled=true},disable_visual_style_options:function(e){if(!e){var t=TvrUi.prevSelInFocusID}else{var t=TvrUi.selInFocusID}var n=$("#"+t);n.removeClass("selector-wrap-overlay");if(TvrUi.transEditing){n.unbind("mouseleave mouseenter")}n.find("div.hidden-options").css("height","auto").removeClass("tvr-transparent");$("#toggle-editing").removeClass("on");TvrUi.visualStylesEnabled=false},toggle_visual_style_options:function(){if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options("fully")}else{TvrUi.enable_visual_style_options()}},insert_google_font:function(e){$.colorbox.close();TvrUi.gFontTarget.val(e).focus();TvrUi.font_changed(TvrUi.gFontTarget)},update_section_vmenu:function(e){TvrUi.prevSecInFocus=TvrUi.secInFocus;TvrUi.secInFocus=e;var t=$("#vmenu-sections");t.find('option:selected, option[selected="selected"]').removeAttr("selected");t.find("option#vmenu-"+e).attr("selected","selected")},update_selector_vmenu:function(e,t){var n=$("#vmenu-selectors");var r=$("#vmenu-selectors-display");var i=n.find("option#"+e);var s="#"+e.replace("vmenu-","vmenu-display-");n.find('option:selected, option[selected="selected"]').removeAttr("selected");i.attr("selected","selected");if(t){TvrUi.displayMenuEmpty=false;var o=i.parent("optgroup").clone();o.find("option").each(function(e){if($(this).hasClass("hidden")){$(this).remove()}$(this).attr("id",$(this).attr("id").replace("vmenu-","vmenu-display-"))});r.find("optgroup").remove();r.append(o);r.find(s).attr("selected","selected")}else{r.find('option:selected, option[selected="selected"]').attr("selected","");r.find(s).prop("selected",true)}},tvr_iterate_selectors_v:function(e){if(e.hasClass("disabled")){return false}var t=e.attr("id");var n=e.attr("class");if(t=="vb-focus-prev"||t=="vb-focus-next"){if(t=="vb-focus-prev"){var r=TvrUi.prevNext[0]}else{var r=TvrUi.prevNext[1]}TvrUi.prevSelInFocusID=TvrUi.selInFocusID;TvrUi.selInFocusID=r.attr("id").replace("view-state","selector");if(TvrUi.prevNext["next-section"]&&t=="vb-focus-next"){TvrUi.update_section_vmenu(TvrUi.prevNext["next-section"])}else if(TvrUi.prevNext["prev-section"]&&t=="vb-focus-prev"){TvrUi.update_section_vmenu(TvrUi.prevNext["prev-section"])}if(TvrUi.prevNext["prev-section"]&&t=="vb-focus-prev"||TvrUi.prevNext["next-section"]&&t=="vb-focus-next"){var i=true;if(TvrUi.visAddSelEnabled||TvrUi.visSelSortable){TvrUi.hide_other_visual("",false)}TvrUi.toggle_enabled_buttons()}else{var i=false}var s=r.attr("id").replace("view-state","vmenu");TvrUi.update_selector_vmenu(s,i)}else if(n.indexOf("vmenu-sel-option")>=0){var o=e.attr("id").replace("vmenu-display","view-state");r=$("#"+o);TvrUi.prevSelInFocusID=TvrUi.selInFocusID;TvrUi.selInFocusID=o.replace("view-state","selector")}else if(n.indexOf("vmenu-sec-option")>=0){TvrUi.prevSecInFocus=TvrUi.secInFocus;TvrUi.secInFocus=e.attr("id").replace("vmenu-","");if(TvrUi.visAddSelEnabled||TvrUi.visSelSortable){TvrUi.hide_other_visual("",false)}var u=$("#strk-"+TvrUi.secInFocus);var o=u.find("input.selector-tracker:eq(0)").attr("id");if(!TvrCom.hasValue(o)){r=u.find("input.section-tracker");TvrUi.update_selector_vmenu(""+r.attr("id").replace("view-state","vmenu"),true);if(TvrUi.visualStylesEnabled){TvrUi.disable_visual_style_options("fully")}TvrUi.selInFocusID=""}else{r=$("#"+o);TvrUi.update_selector_vmenu(""+o.replace("view-state","vmenu"),true);TvrUi.prevSelInFocusID=TvrUi.selInFocusID;TvrUi.selInFocusID=o.replace("view-state","selector")}TvrUi.toggle_enabled_buttons()}window.TvrSharedVars.curSelCSS=r.attr("title");if(window.frames["viframe"].TvrExportVars){window.frames["viframe"].TvrExportVars.switch_highlight("reg")}TvrUi.prevNext=TvrUi.update_visual_controls(r)}};TvrUi.init();window.TvrSharedVars.print_r=TvrCom.print_r;window.TvrSharedVars.extract_str=TvrCom.extract_str;window.TvrSharedVars.custom_to_non_escaped=TvrUi.custom_to_non_escaped;window.TvrSharedVars.update_prog_indicator=TvrUi.update_prog_indicator;window.TvrSharedVars.hasValue=TvrCom.hasValue;window.TvrSharedVars.display_visual_add_sec_sel=TvrUi.display_visual_add_sec_sel;window.TvrSharedVars.update_selector_wizard=TvrUi.update_selector_wizard;window.TvrSharedVars.toggle_highlighting=TvrUi.toggle_highlighting;window.TvrSharedVars.insert_google_font=TvrUi.insert_google_font;window.TvrSharedVars.ajax_save_settings=TvrUi.ajax_save_settings;window.TvrSharedVars.remember_page_viewed=TvrUi.remember_page_viewed;window.TvrSharedVars.refresh_comp_css=TvrUi.refresh_comp_css})